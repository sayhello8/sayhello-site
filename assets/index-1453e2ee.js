var si=Object.defineProperty;var ii=(a,e,t)=>e in a?si(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var En=(a,e,t)=>(ii(a,typeof e!="symbol"?e+"":e,t),t);import{aF as ri,B as yn,a2 as Ae,aG as oi,aH as rn,aI as Os,aJ as xn,aK as ze,F as ut,C as le,I as ne,aL as ai,P as ci,h as hi,M as Ie,m as fe,aM as re,a as Ls,y as dt,V as we,aN as li,aO as ui,O as Is,a5 as Ps,aP as di,aQ as fi,_ as Cs,aR as zs,R as on,p as pi,aS as Et,L as gi,d as Ds,D as mi,aT as yi,aU as xi,b as ks,a9 as wi,ac as Ai,f as Ti,t as Si,G as bt,w as an,ar as Mi,aV as Fs,aW as _i,aX as Ei,aY as bi,aZ as Bs,at as bn,ah as Gs,N as vi,a_ as Ri,a$ as Ni,b0 as Oi,b1 as Li,b2 as Ii,b3 as Pi,b4 as Ci,al as zi,u as vn,b5 as Rn,b6 as Nn,b7 as On,ai as Di,an as ki,b8 as Fi,b9 as Bi,aB as Gi,aE as Ui,aA as Hi,aD as Ji}from"./OrbitControls-9c9ee6bc.js";class wt{constructor(){this.events=new Map}on(e,t){let n=this.events.get(e);n||(n=new Set,this.events.set(e,n)),n.add(t)}off(e,t){const n=this.events.get(e);n&&(t?n.delete(t):this.events.delete(e))}emit(e,...t){const n=this.events.get(e);n&&n.forEach(s=>{s(...t)})}once(e,t){const n=(...s)=>{t(...s),this.off(e,n)};this.on(e,n)}}class Vi extends wt{constructor({canvas:e}){super(),this.canvas=e,this.pixelRatio=0,this.init(),window.addEventListener("resize",()=>{this.init(),this.emit("resize")})}init(){this.width=window.innerWidth,this.height=window.innerHeight,this.pixelRatio=this.pixelRatio||Math.min(window.devicePixelRatio,2)}destroy(){this.off("resize")}}class qi extends wt{constructor(){super(),this.start=Date.now(),this.current=this.start,this.elapsed=0,this.delta=16,this.clock=new ri,this.timer=window.requestAnimationFrame(()=>{this.tick()})}tick(){const e=Date.now();this.delta=e-this.current,this.current=e,this.elapsed=this.current-this.start;const t=this.clock.getDelta(),n=this.clock.getElapsedTime();if(this.emit("tick",t,n),this.stop)return window.cancelAnimationFrame(this.timer),!1;this.timer=window.requestAnimationFrame(()=>{this.tick()})}destroy(){this.stop=!0,this.off("tick")}}function ra(a,e=!1){const t=a[0].index!==null,n=new Set(Object.keys(a[0].attributes)),s=new Set(Object.keys(a[0].morphAttributes)),i={},r={},o=a[0].morphTargetsRelative,c=new yn;let l=0;for(let h=0;h<a.length;++h){const u=a[h];let d=0;if(t!==(u.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const f in u.attributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;i[f]===void 0&&(i[f]=[]),i[f].push(u.attributes[f]),d++}if(d!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(o!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const f in u.morphAttributes){if(!s.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;r[f]===void 0&&(r[f]=[]),r[f].push(u.morphAttributes[f])}if(e){let f;if(t)f=u.index.count;else if(u.attributes.position!==void 0)f=u.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;c.addGroup(l,f,h),l+=f}}if(t){let h=0;const u=[];for(let d=0;d<a.length;++d){const f=a[d].index;for(let p=0;p<f.count;++p)u.push(f.getX(p)+h);h+=a[d].attributes.position.count}c.setIndex(u)}for(const h in i){const u=Ln(i[h]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" attribute."),null;c.setAttribute(h,u)}for(const h in r){const u=r[h][0].length;if(u===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[h]=[];for(let d=0;d<u;++d){const f=[];for(let y=0;y<r[h].length;++y)f.push(r[h][y][d]);const p=Ln(f);if(!p)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" morphAttribute."),null;c.morphAttributes[h].push(p)}}return c}function Ln(a){let e,t,n,s=-1,i=0;for(let l=0;l<a.length;++l){const h=a[l];if(h.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=h.array.constructor),e!==h.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=h.itemSize),t!==h.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=h.normalized),n!==h.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(s===-1&&(s=h.gpuType),s!==h.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;i+=h.array.length}const r=new e(i);let o=0;for(let l=0;l<a.length;++l)r.set(a[l].array,o),o+=a[l].array.length;const c=new Ae(r,t,n);return s!==void 0&&(c.gpuType=s),c}function In(a,e){if(e===oi)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(e===rn||e===Os){let t=a.getIndex();if(t===null){const r=[],o=a.getAttribute("position");if(o!==void 0){for(let c=0;c<o.count;c++)r.push(c);a.setIndex(r),t=a.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const n=t.count-2,s=[];if(e===rn)for(let r=1;r<=n;r++)s.push(t.getX(0)),s.push(t.getX(r)),s.push(t.getX(r+1));else for(let r=0;r<n;r++)r%2===0?(s.push(t.getX(r)),s.push(t.getX(r+1)),s.push(t.getX(r+2))):(s.push(t.getX(r+2)),s.push(t.getX(r+1)),s.push(t.getX(r)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=a.clone();return i.setIndex(s),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),a}class Ki extends xn{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Yi(t)}),this.register(function(t){return new or(t)}),this.register(function(t){return new ar(t)}),this.register(function(t){return new cr(t)}),this.register(function(t){return new Zi(t)}),this.register(function(t){return new er(t)}),this.register(function(t){return new tr(t)}),this.register(function(t){return new nr(t)}),this.register(function(t){return new $i(t)}),this.register(function(t){return new sr(t)}),this.register(function(t){return new Qi(t)}),this.register(function(t){return new rr(t)}),this.register(function(t){return new ir(t)}),this.register(function(t){return new ji(t)}),this.register(function(t){return new hr(t)}),this.register(function(t){return new lr(t)})}load(e,t,n,s){const i=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const l=ze.extractUrlBase(e);r=ze.resolveURL(l,this.path)}else r=ze.extractUrlBase(e);this.manager.itemStart(e);const o=function(l){s?s(l):console.error(l),i.manager.itemError(e),i.manager.itemEnd(e)},c=new ut(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{i.parse(l,r,function(h){t(h),i.manager.itemEnd(e)},o)}catch(h){o(h)}},n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let i;const r={},o={},c=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===Us){try{r[O.KHR_BINARY_GLTF]=new ur(e)}catch(u){s&&s(u);return}i=JSON.parse(r[O.KHR_BINARY_GLTF].content)}else i=JSON.parse(c.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new _r(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[u.name]=u,r[u.name]=!0}if(i.extensionsUsed)for(let h=0;h<i.extensionsUsed.length;++h){const u=i.extensionsUsed[h],d=i.extensionsRequired||[];switch(u){case O.KHR_MATERIALS_UNLIT:r[u]=new Xi;break;case O.KHR_DRACO_MESH_COMPRESSION:r[u]=new dr(i,this.dracoLoader);break;case O.KHR_TEXTURE_TRANSFORM:r[u]=new fr;break;case O.KHR_MESH_QUANTIZATION:r[u]=new pr;break;default:d.indexOf(u)>=0&&o[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(r),l.setPlugins(o),l.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,i){n.parse(e,t,s,i)})}}function Wi(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const O={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ji{constructor(e){this.parser=e,this.name=O.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const i=t.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let l;const h=new le(16777215);c.color!==void 0&&h.setRGB(c.color[0],c.color[1],c.color[2],ne);const u=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new hi(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new ci(h),l.distance=u;break;case"spot":l=new ai(h),l.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,he(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),s=Promise.resolve(l),t.cache.add(n,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],o=(i.extensions&&i.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(c){return n._getNodeRef(t.cache,o,c)})}}class Xi{constructor(){this.name=O.KHR_MATERIALS_UNLIT}getMaterialType(){return Ie}extendParams(e,t,n){const s=[];e.color=new le(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const r=i.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],ne),e.opacity=r[3]}i.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",i.baseColorTexture,fe))}return Promise.all(s)}}class $i{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class Yi{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:re}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&i.push(n.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(i.push(n.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const o=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ls(o,o)}return Promise.all(i)}}class Qi{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:re}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&i.push(n.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&i.push(n.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(i)}}class Zi{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:re}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new le(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=s.extensions[this.name];if(r.sheenColorFactor!==void 0){const o=r.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],ne)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&i.push(n.assignTexture(t,"sheenColorMap",r.sheenColorTexture,fe)),r.sheenRoughnessTexture!==void 0&&i.push(n.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(i)}}class er{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:re}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&i.push(n.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(i)}}class tr{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:re}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&i.push(n.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const o=r.attenuationColor||[1,1,1];return t.attenuationColor=new le().setRGB(o[0],o[1],o[2],ne),Promise.all(i)}}class nr{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:re}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class sr{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:re}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&i.push(n.assignTexture(t,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return t.specularColor=new le().setRGB(o[0],o[1],o[2],ne),r.specularColorTexture!==void 0&&i.push(n.assignTexture(t,"specularColorMap",r.specularColorTexture,fe)),Promise.all(i)}}class ir{constructor(e){this.parser=e,this.name=O.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:re}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&i.push(n.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(i)}}class rr{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:re}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&i.push(n.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(i)}}class or{constructor(e){this.parser=e,this.name=O.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const i=s.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,r)}}class ar{constructor(e){this.parser=e,this.name=O.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,i=s.textures[e];if(!i.extensions||!i.extensions[t])return null;const r=i.extensions[t],o=s.images[r.source];let c=n.textureLoader;if(o.uri){const l=n.options.manager.getHandler(o.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,r.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class cr{constructor(e){this.parser=e,this.name=O.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,i=s.textures[e];if(!i.extensions||!i.extensions[t])return null;const r=i.extensions[t],o=s.images[r.source];let c=n.textureLoader;if(o.uri){const l=n.options.manager.getHandler(o.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,r.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class hr{constructor(e){this.name=O.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],i=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(o){const c=s.byteOffset||0,l=s.byteLength||0,h=s.count,u=s.byteStride,d=new Uint8Array(o,c,l);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(h,u,d,s.mode,s.filter).then(function(f){return f.buffer}):r.ready.then(function(){const f=new ArrayBuffer(h*u);return r.decodeGltfBuffer(new Uint8Array(f),h,u,d,s.mode,s.filter),f})})}else return null}}class lr{constructor(e){this.name=O.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const l of s.primitives)if(l.mode!==Q.TRIANGLES&&l.mode!==Q.TRIANGLE_STRIP&&l.mode!==Q.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=n.extensions[this.name].attributes,o=[],c={};for(const l in r)o.push(this.parser.getDependency("accessor",r[l]).then(h=>(c[l]=h,c[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(l=>{const h=l.pop(),u=h.isGroup?h.children:[h],d=l[0].count,f=[];for(const p of u){const y=new dt,g=new we,m=new Gs,x=new we(1,1,1),S=new li(p.geometry,p.material,d);for(let A=0;A<d;A++)c.TRANSLATION&&g.fromBufferAttribute(c.TRANSLATION,A),c.ROTATION&&m.fromBufferAttribute(c.ROTATION,A),c.SCALE&&x.fromBufferAttribute(c.SCALE,A),S.setMatrixAt(A,y.compose(g,m,x));for(const A in c)if(A==="_COLOR_0"){const _=c[A];S.instanceColor=new ui(_.array,_.itemSize,_.normalized)}else A!=="TRANSLATION"&&A!=="ROTATION"&&A!=="SCALE"&&p.geometry.setAttribute(A,c[A]);Is.prototype.copy.call(S,p),this.parser.assignFinalMaterial(S),f.push(S)}return h.isGroup?(h.clear(),h.add(...f),h):f[0]}))}}const Us="glTF",_e=12,Pn={JSON:1313821514,BIN:5130562};class ur{constructor(e){this.name=O.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,_e),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Us)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-_e,i=new DataView(e,_e);let r=0;for(;r<s;){const o=i.getUint32(r,!0);r+=4;const c=i.getUint32(r,!0);if(r+=4,c===Pn.JSON){const l=new Uint8Array(e,_e+r,o);this.content=n.decode(l)}else if(c===Pn.BIN){const l=_e+r;this.body=e.slice(l,l+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class dr{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=O.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,i=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},c={},l={};for(const h in r){const u=cn[h]||h.toLowerCase();o[u]=r[h]}for(const h in e.attributes){const u=cn[h]||h.toLowerCase();if(r[h]!==void 0){const d=n.accessors[e.attributes[h]],f=Te[d.componentType];l[u]=f.name,c[u]=d.normalized===!0}}return t.getDependency("bufferView",i).then(function(h){return new Promise(function(u,d){s.decodeDracoFile(h,function(f){for(const p in f.attributes){const y=f.attributes[p],g=c[p];g!==void 0&&(y.normalized=g)}u(f)},o,l,ne,d)})})}}class fr{constructor(){this.name=O.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class pr{constructor(){this.name=O.KHR_MESH_QUANTIZATION}}class Hs extends Fi{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,i=e*s*3+s;for(let r=0;r!==s;r++)t[r]=n[i+r];return t}interpolate_(e,t,n,s){const i=this.resultBuffer,r=this.sampleValues,o=this.valueSize,c=o*2,l=o*3,h=s-t,u=(n-t)/h,d=u*u,f=d*u,p=e*l,y=p-l,g=-2*f+3*d,m=f-d,x=1-g,S=m-d+u;for(let A=0;A!==o;A++){const _=r[y+A+o],E=r[y+A+c]*h,b=r[p+A+o],R=r[p+A]*h;i[A]=x*_+S*E+g*b+m*R}return i}}const gr=new Gs;class mr extends Hs{interpolate_(e,t,n,s){const i=super.interpolate_(e,t,n,s);return gr.fromArray(i).normalize().toArray(i),i}}const Q={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Te={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Cn={9728:vi,9729:Cs,9984:Ri,9985:Ni,9986:Oi,9987:zs},zn={33071:Li,33648:Ii,10497:on},vt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},oe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},yr={CUBICSPLINE:void 0,LINEAR:Bs,STEP:Pi},Rt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function xr(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new Ds({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ci})),a.DefaultMaterial}function de(a,e,t){for(const n in t.extensions)a[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function he(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function wr(a,e,t){let n=!1,s=!1,i=!1;for(let l=0,h=e.length;l<h;l++){const u=e[l];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(i=!0),n&&s&&i)break}if(!n&&!s&&!i)return Promise.resolve(a);const r=[],o=[],c=[];for(let l=0,h=e.length;l<h;l++){const u=e[l];if(n){const d=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):a.attributes.position;r.push(d)}if(s){const d=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):a.attributes.normal;o.push(d)}if(i){const d=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):a.attributes.color;c.push(d)}}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],d=l[2];return n&&(a.morphAttributes.position=h),s&&(a.morphAttributes.normal=u),i&&(a.morphAttributes.color=d),a.morphTargetsRelative=!0,a})}function Ar(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)a.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Tr(a){let e;const t=a.extensions&&a.extensions[O.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Nt(t.attributes):e=a.indices+":"+Nt(a.attributes)+":"+a.mode,a.targets!==void 0)for(let n=0,s=a.targets.length;n<s;n++)e+=":"+Nt(a.targets[n]);return e}function Nt(a){let e="";const t=Object.keys(a).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+a[t[n]]+";";return e}function hn(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Sr(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Mr=new dt;class _r{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Wi,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,i=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,i=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||s&&i<98?this.textureLoader=new Ps(this.options.manager):this.textureLoader=new di(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ut(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(r){const o={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:n,userData:{}};return de(i,o,s),he(o,s),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(o)})).then(function(){e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,i=t.length;s<i;s++){const r=t[s].joints;for(let o=0,c=r.length;o<c;o++)e[r[o]].isBone=!0}for(let s=0,i=e.length;s<i;s++){const r=e[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(n[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),i=(r,o)=>{const c=this.associations.get(r);c!=null&&this.associations.set(o,c);for(const[l,h]of r.children.entries())i(h,o.children[l])};return i(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const i=e(t[s]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":s=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(i,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[O.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(i,r){n.load(ze.resolveURL(t.uri,s.path),i,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,i=t.byteOffset||0;return n.slice(i,i+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const r=vt[s.type],o=Te[s.componentType],c=s.normalized===!0,l=new o(s.count*r);return Promise.resolve(new Ae(l,r,c))}const i=[];return s.bufferView!==void 0?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),s.sparse!==void 0&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(r){const o=r[0],c=vt[s.type],l=Te[s.componentType],h=l.BYTES_PER_ELEMENT,u=h*c,d=s.byteOffset||0,f=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,p=s.normalized===!0;let y,g;if(f&&f!==u){const m=Math.floor(d/f),x="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+m+":"+s.count;let S=t.cache.get(x);S||(y=new l(o,m*f,s.count*f/h),S=new fi(y,f/h),t.cache.add(x,S)),g=new zi(S,c,d%f/h,p)}else o===null?y=new l(s.count*c):y=new l(o,d,s.count*c),g=new Ae(y,c,p);if(s.sparse!==void 0){const m=vt.SCALAR,x=Te[s.sparse.indices.componentType],S=s.sparse.indices.byteOffset||0,A=s.sparse.values.byteOffset||0,_=new x(r[1],S,s.sparse.count*m),E=new l(r[2],A,s.sparse.count*c);o!==null&&(g=new Ae(g.array.slice(),g.itemSize,g.normalized));for(let b=0,R=_.length;b<R;b++){const M=_[b];if(g.setX(M,E[b*c]),c>=2&&g.setY(M,E[b*c+1]),c>=3&&g.setZ(M,E[b*c+2]),c>=4&&g.setW(M,E[b*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i];let o=this.textureLoader;if(r.uri){const c=n.manager.getHandler(r.uri);c!==null&&(o=c)}return this.loadTextureImage(e,i,o)}loadTextureImage(e,t,n){const s=this,i=this.json,r=i.textures[e],o=i.images[t],c=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,n).then(function(h){h.flipY=!1,h.name=r.name||o.name||"",h.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(h.name=o.uri);const d=(i.samplers||{})[r.sampler]||{};return h.magFilter=Cn[d.magFilter]||Cs,h.minFilter=Cn[d.minFilter]||zs,h.wrapS=zn[d.wrapS]||on,h.wrapT=zn[d.wrapT]||on,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const n=this,s=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const r=s.images[e],o=self.URL||self.webkitURL;let c=r.uri||"",l=!1;if(r.bufferView!==void 0)c=n.getDependency("bufferView",r.bufferView).then(function(u){l=!0;const d=new Blob([u],{type:r.mimeType});return c=o.createObjectURL(d),c});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(u){return new Promise(function(d,f){let p=d;t.isImageBitmapLoader===!0&&(p=function(y){const g=new vn(y);g.needsUpdate=!0,d(g)}),t.load(ze.resolveURL(u,i.path),p,void 0,f)})}).then(function(u){return l===!0&&o.revokeObjectURL(c),u.userData.mimeType=r.mimeType||Sr(r.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[e]=h,h}assignTexture(e,t,n,s){const i=this;return this.getDependency("texture",n.index).then(function(r){if(!r)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(r=r.clone(),r.channel=n.texCoord),i.extensions[O.KHR_TEXTURE_TRANSFORM]){const o=n.extensions!==void 0?n.extensions[O.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const c=i.associations.get(r);r=i.extensions[O.KHR_TEXTURE_TRANSFORM].extendTexture(r,o),i.associations.set(r,c)}}return s!==void 0&&(r.colorSpace=s),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+n.uuid;let c=this.cache.get(o);c||(c=new pi,Et.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(o,c)),n=c}else if(e.isLine){const o="LineBasicMaterial:"+n.uuid;let c=this.cache.get(o);c||(c=new gi,Et.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(o,c)),n=c}if(s||i||r){let o="ClonedMaterial:"+n.uuid+":";s&&(o+="derivative-tangents:"),i&&(o+="vertex-colors:"),r&&(o+="flat-shading:");let c=this.cache.get(o);c||(c=n.clone(),i&&(c.vertexColors=!0),r&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(o,c),this.associations.set(c,this.associations.get(n))),n=c}e.material=n}getMaterialType(){return Ds}loadMaterial(e){const t=this,n=this.json,s=this.extensions,i=n.materials[e];let r;const o={},c=i.extensions||{},l=[];if(c[O.KHR_MATERIALS_UNLIT]){const u=s[O.KHR_MATERIALS_UNLIT];r=u.getMaterialType(),l.push(u.extendParams(o,i,t))}else{const u=i.pbrMetallicRoughness||{};if(o.color=new le(1,1,1),o.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;o.color.setRGB(d[0],d[1],d[2],ne),o.opacity=d[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(o,"map",u.baseColorTexture,fe)),o.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,o.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(o,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(o,"roughnessMap",u.metallicRoughnessTexture))),r=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,o)})))}i.doubleSided===!0&&(o.side=mi);const h=i.alphaMode||Rt.OPAQUE;if(h===Rt.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===Rt.MASK&&(o.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&r!==Ie&&(l.push(t.assignTexture(o,"normalMap",i.normalTexture)),o.normalScale=new Ls(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;o.normalScale.set(u,u)}if(i.occlusionTexture!==void 0&&r!==Ie&&(l.push(t.assignTexture(o,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&r!==Ie){const u=i.emissiveFactor;o.emissive=new le().setRGB(u[0],u[1],u[2],ne)}return i.emissiveTexture!==void 0&&r!==Ie&&l.push(t.assignTexture(o,"emissiveMap",i.emissiveTexture,fe)),Promise.all(l).then(function(){const u=new r(o);return i.name&&(u.name=i.name),he(u,i),t.associations.set(u,{materials:e}),i.extensions&&de(s,u,i),u})}createUniqueName(e){const t=yi.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function i(o){return n[O.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(c){return Dn(c,o,t)})}const r=[];for(let o=0,c=e.length;o<c;o++){const l=e[o],h=Tr(l),u=s[h];if(u)r.push(u.promise);else{let d;l.extensions&&l.extensions[O.KHR_DRACO_MESH_COMPRESSION]?d=i(l):d=Dn(new yn,l,t),s[h]={primitive:l,promise:d},r.push(d)}}return Promise.all(r)}loadMesh(e){const t=this,n=this.json,s=this.extensions,i=n.meshes[e],r=i.primitives,o=[];for(let c=0,l=r.length;c<l;c++){const h=r[c].material===void 0?xr(this.cache):this.getDependency("material",r[c].material);o.push(h)}return o.push(t.loadGeometries(r)),Promise.all(o).then(function(c){const l=c.slice(0,c.length-1),h=c[c.length-1],u=[];for(let f=0,p=h.length;f<p;f++){const y=h[f],g=r[f];let m;const x=l[f];if(g.mode===Q.TRIANGLES||g.mode===Q.TRIANGLE_STRIP||g.mode===Q.TRIANGLE_FAN||g.mode===void 0)m=i.isSkinnedMesh===!0?new xi(y,x):new ks(y,x),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),g.mode===Q.TRIANGLE_STRIP?m.geometry=In(m.geometry,Os):g.mode===Q.TRIANGLE_FAN&&(m.geometry=In(m.geometry,rn));else if(g.mode===Q.LINES)m=new wi(y,x);else if(g.mode===Q.LINE_STRIP)m=new Ai(y,x);else if(g.mode===Q.LINE_LOOP)m=new Ti(y,x);else if(g.mode===Q.POINTS)m=new Si(y,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(m.geometry.morphAttributes).length>0&&Ar(m,i),m.name=t.createUniqueName(i.name||"mesh_"+e),he(m,i),g.extensions&&de(s,m,g),t.assignFinalMaterial(m),u.push(m)}for(let f=0,p=u.length;f<p;f++)t.associations.set(u[f],{meshes:e,primitives:f});if(u.length===1)return i.extensions&&de(s,u[0],i),u[0];const d=new bt;i.extensions&&de(s,d,i),t.associations.set(d,{meshes:e});for(let f=0,p=u.length;f<p;f++)d.add(u[f]);return d})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new an(Mi.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new Fs(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),he(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let s=0,i=t.joints.length;s<i;s++)n.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(s){const i=s.pop(),r=s,o=[],c=[];for(let l=0,h=r.length;l<h;l++){const u=r[l];if(u){o.push(u);const d=new dt;i!==null&&d.fromArray(i.array,l*16),c.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new _i(o,c)})}loadAnimation(e){const t=this.json,n=this,s=t.animations[e],i=s.name?s.name:"animation_"+e,r=[],o=[],c=[],l=[],h=[];for(let u=0,d=s.channels.length;u<d;u++){const f=s.channels[u],p=s.samplers[f.sampler],y=f.target,g=y.node,m=s.parameters!==void 0?s.parameters[p.input]:p.input,x=s.parameters!==void 0?s.parameters[p.output]:p.output;y.node!==void 0&&(r.push(this.getDependency("node",g)),o.push(this.getDependency("accessor",m)),c.push(this.getDependency("accessor",x)),l.push(p),h.push(y))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(c),Promise.all(l),Promise.all(h)]).then(function(u){const d=u[0],f=u[1],p=u[2],y=u[3],g=u[4],m=[];for(let x=0,S=d.length;x<S;x++){const A=d[x],_=f[x],E=p[x],b=y[x],R=g[x];if(A===void 0)continue;A.updateMatrix&&A.updateMatrix();const M=n._createAnimationTracks(A,_,E,b,R);if(M)for(let I=0;I<M.length;I++)m.push(M[I])}return new Ei(i,void 0,m)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(i){const r=n._getNodeRef(n.meshCache,s.mesh,i);return s.weights!==void 0&&r.traverse(function(o){if(o.isMesh)for(let c=0,l=s.weights.length;c<l;c++)o.morphTargetInfluences[c]=s.weights[c]}),r})}loadNode(e){const t=this.json,n=this,s=t.nodes[e],i=n._loadNodeShallow(e),r=[],o=s.children||[];for(let l=0,h=o.length;l<h;l++)r.push(n.getDependency("node",o[l]));const c=s.skin===void 0?Promise.resolve(null):n.getDependency("skin",s.skin);return Promise.all([i,Promise.all(r),c]).then(function(l){const h=l[0],u=l[1],d=l[2];d!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(d,Mr)});for(let f=0,p=u.length;f<p;f++)h.add(u[f]);return h})}_loadNodeShallow(e){const t=this.json,n=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=t.nodes[e],r=i.name?s.createUniqueName(i.name):"",o=[],c=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&o.push(c),i.camera!==void 0&&o.push(s.getDependency("camera",i.camera).then(function(l){return s._getNodeRef(s.cameraCache,i.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){o.push(l)}),this.nodeCache[e]=Promise.all(o).then(function(l){let h;if(i.isBone===!0?h=new bi:l.length>1?h=new bt:l.length===1?h=l[0]:h=new Is,h!==l[0])for(let u=0,d=l.length;u<d;u++)h.add(l[u]);if(i.name&&(h.userData.name=i.name,h.name=r),he(h,i),i.extensions&&de(n,h,i),i.matrix!==void 0){const u=new dt;u.fromArray(i.matrix),h.applyMatrix4(u)}else i.translation!==void 0&&h.position.fromArray(i.translation),i.rotation!==void 0&&h.quaternion.fromArray(i.rotation),i.scale!==void 0&&h.scale.fromArray(i.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,i=new bt;n.name&&(i.name=s.createUniqueName(n.name)),he(i,n),n.extensions&&de(t,i,n);const r=n.nodes||[],o=[];for(let c=0,l=r.length;c<l;c++)o.push(s.getDependency("node",r[c]));return Promise.all(o).then(function(c){for(let h=0,u=c.length;h<u;h++)i.add(c[h]);const l=h=>{const u=new Map;for(const[d,f]of s.associations)(d instanceof Et||d instanceof vn)&&u.set(d,f);return h.traverse(d=>{const f=s.associations.get(d);f!=null&&u.set(d,f)}),u};return s.associations=l(i),i})}_createAnimationTracks(e,t,n,s,i){const r=[],o=e.name?e.name:e.uuid,c=[];oe[i.path]===oe.weights?e.traverse(function(d){d.morphTargetInfluences&&c.push(d.name?d.name:d.uuid)}):c.push(o);let l;switch(oe[i.path]){case oe.weights:l=Nn;break;case oe.rotation:l=On;break;case oe.position:case oe.scale:l=Rn;break;default:switch(n.itemSize){case 1:l=Nn;break;case 2:case 3:default:l=Rn;break}break}const h=s.interpolation!==void 0?yr[s.interpolation]:Bs,u=this._getArrayFromAccessor(n);for(let d=0,f=c.length;d<f;d++){const p=new l(c[d]+"."+oe[i.path],t.array,u,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),r.push(p)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=hn(t.constructor),s=new Float32Array(t.length);for(let i=0,r=t.length;i<r;i++)s[i]=t[i]*n;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const s=this instanceof On?mr:Hs;return new s(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Er(a,e,t){const n=e.attributes,s=new Di;if(n.POSITION!==void 0){const o=t.json.accessors[n.POSITION],c=o.min,l=o.max;if(c!==void 0&&l!==void 0){if(s.set(new we(c[0],c[1],c[2]),new we(l[0],l[1],l[2])),o.normalized){const h=hn(Te[o.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const o=new we,c=new we;for(let l=0,h=i.length;l<h;l++){const u=i[l];if(u.POSITION!==void 0){const d=t.json.accessors[u.POSITION],f=d.min,p=d.max;if(f!==void 0&&p!==void 0){if(c.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),c.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),c.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),d.normalized){const y=hn(Te[d.componentType]);c.multiplyScalar(y)}o.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(o)}a.boundingBox=s;const r=new ki;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,a.boundingSphere=r}function Dn(a,e,t){const n=e.attributes,s=[];function i(r,o){return t.getDependency("accessor",r).then(function(c){a.setAttribute(o,c)})}for(const r in n){const o=cn[r]||r.toLowerCase();o in a.attributes||s.push(i(n[r],o))}if(e.indices!==void 0&&!a.index){const r=t.getDependency("accessor",e.indices).then(function(o){a.setIndex(o)});s.push(r)}return bn.workingColorSpace!==ne&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${bn.workingColorSpace}" not supported.`),he(a,e),Er(a,e,t),Promise.all(s).then(function(){return e.targets!==void 0?wr(a,e.targets,t):a})}const Ot=new WeakMap;class br extends xn{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,s){const i=new ut(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,r=>{this.parse(r,t,s)},n,s)}parse(e,t,n=()=>{}){this.decodeDracoFile(e,t,null,null,fe).catch(n)}decodeDracoFile(e,t,n,s,i=ne,r=()=>{}){const o={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:i};return this.decodeGeometry(e,o).then(t).catch(r)}decodeGeometry(e,t){const n=JSON.stringify(t);if(Ot.has(e)){const c=Ot.get(e);if(c.key===n)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const i=this.workerNextTaskID++,r=e.byteLength,o=this._getWorker(i,r).then(c=>(s=c,new Promise((l,h)=>{s._callbacks[i]={resolve:l,reject:h},s.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return o.catch(()=>!0).then(()=>{s&&i&&this._releaseTask(s,i)}),Ot.set(e,{key:n,promise:o}),o}_createGeometry(e){const t=new yn;e.index&&t.setIndex(new Ae(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n],i=s.name,r=s.array,o=s.itemSize,c=new Ae(r,o);i==="color"&&(this._assignVertexColorSpace(c,s.vertexColorSpace),c.normalized=!(r instanceof Float32Array)),t.setAttribute(i,c)}return t}_assignVertexColorSpace(e,t){if(t!==fe)return;const n=new le;for(let s=0,i=e.count;s<i;s++)n.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new ut(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((s,i)=>{n.load(e,s,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const s=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const i=vr.toString(),r=["/* draco decoder */",s,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(i){const r=i.data;switch(r.type){case"decode":s._callbacks[r.id].resolve(r);break;case"error":s._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,i){return s._taskLoad>i._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function vr(){let a,e;onmessage=function(r){const o=r.data;switch(o.type){case"init":a=o.decoderConfig,e=new Promise(function(h){a.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(a)});break;case"decode":const c=o.buffer,l=o.taskConfig;e.then(h=>{const u=h.draco,d=new u.Decoder;try{const f=t(u,d,new Int8Array(c),l),p=f.attributes.map(y=>y.array.buffer);f.index&&p.push(f.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:f},p)}catch(f){console.error(f),self.postMessage({type:"error",id:o.id,error:f.message})}finally{u.destroy(d)}});break}};function t(r,o,c,l){const h=l.attributeIDs,u=l.attributeTypes;let d,f;const p=o.GetEncodedGeometryType(c);if(p===r.TRIANGULAR_MESH)d=new r.Mesh,f=o.DecodeArrayToMesh(c,c.byteLength,d);else if(p===r.POINT_CLOUD)d=new r.PointCloud,f=o.DecodeArrayToPointCloud(c,c.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const y={index:null,attributes:[]};for(const g in h){const m=self[u[g]];let x,S;if(l.useUniqueIDs)S=h[g],x=o.GetAttributeByUniqueId(d,S);else{if(S=o.GetAttributeId(d,r[h[g]]),S===-1)continue;x=o.GetAttribute(d,S)}const A=s(r,o,d,g,m,x);g==="color"&&(A.vertexColorSpace=l.vertexColorSpace),y.attributes.push(A)}return p===r.TRIANGULAR_MESH&&(y.index=n(r,o,d)),r.destroy(d),y}function n(r,o,c){const h=c.num_faces()*3,u=h*4,d=r._malloc(u);o.GetTrianglesUInt32Array(c,u,d);const f=new Uint32Array(r.HEAPF32.buffer,d,h).slice();return r._free(d),{array:f,itemSize:1}}function s(r,o,c,l,h,u){const d=u.num_components(),p=c.num_points()*d,y=p*h.BYTES_PER_ELEMENT,g=i(r,h),m=r._malloc(y);o.GetAttributeDataArrayForAllPoints(c,u,g,y,m);const x=new h(r.HEAPF32.buffer,m,p).slice();return r._free(m),{name:l,array:x,itemSize:d}}function i(r,o){switch(o){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}let ln={GLTFLoader:"GLTF",TextureLoader:"Texture",FontLoader:"Font",MMDLoader:"MMD",MTLLoader:"MTL",OBJLoader:"OBJ",PCDLoader:"PCD",FileLoader:"File",ImageLoader:"Image",ObjectLoader:"Object",MaterialLoader:"Material",CubeTextureLoader:"CubeTexture",RGBELoader:"RGBELoader",FBXLoader:"FBX"};const Rr=Object.values(ln);class oa extends wt{constructor({dracoPath:e}={}){super(),this.dracoPath=e||"./draco/gltf/",this.itemsLoaded=0,this.itemsTotal=0,this.assets=[],this.loaders={},this.initDefaultLoader()}initManager(){const e=new Bi;return e.onProgress=(t,n,s)=>{this.itemsLoaded=n,this.itemsTotal=s,this.emit("onProgress",t,n,s)},e.onError=t=>{this.emit("onError",t)},e}initDefaultLoader(){[{loader:Ki,name:"GLTFLoader"},{loader:Ps,name:"TextureLoader"}].map(e=>this.addLoader(e.loader,e.name))}initDraco(e){const t=new br;t.setDecoderPath(this.dracoPath),t.preload(),e.setDRACOLoader(t)}addLoader(e,t=""){if(e.name&&ln[t]){if(!this.loaders[t]){let s=new e(this.manager),i=t;s instanceof xn&&(i==="GLTFLoader"&&this.initDraco(s),this.loaders[ln[i]]=s)}}else throw new Error("")}loadItem(e){return new Promise((t,n)=>{if(!this.loaders[e.type])throw new Error(`${e.path}`);this.loaders[e.type].load(e.path,s=>{this.itemsLoaded++,this.emit("onProgress",e.path,this.itemsLoaded,this.itemsTotal),t({...e,data:s})},null,s=>{this.emit("onError",s),n(s)})})}loadAll(e){return this.itemsLoaded=0,this.itemsTotal=0,new Promise((t,n)=>{let s=this.matchType(e),i=[];this.itemsTotal=s.length,s.map(r=>{let o=this.loadItem(r);i.push(o)}),Promise.all(i).then(r=>{this.assets=r,this.emit("onLoad"),t(r)}).catch(r=>{this.emit("onError",r),n(r)})})}matchType(e){return this.assets=e.map(t=>({type:Rr.includes(t.type)?t.type:"",path:t.path,name:t.name,data:null})).filter(t=>{if(!t.type)throw new Error(`${t.path},type`);return t.type}),this.assets}getResource(e){let t=this.assets.find(n=>n.name===e);if(!t)throw new Error(`${e}`);return t.data}destroy(){this.off("onProgress"),this.off("onLoad"),this.off("onError"),this.assets=[]}}var aa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nr(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var At={exports:{}},Or=function(e,t,n,s){var i=e[0],r=e[1],o=!1;n===void 0&&(n=0),s===void 0&&(s=t.length);for(var c=(s-n)/2,l=0,h=c-1;l<c;h=l++){var u=t[n+l*2+0],d=t[n+l*2+1],f=t[n+h*2+0],p=t[n+h*2+1],y=d>r!=p>r&&i<(f-u)*(r-d)/(p-d)+u;y&&(o=!o)}return o},Lr=function(e,t,n,s){var i=e[0],r=e[1],o=!1;n===void 0&&(n=0),s===void 0&&(s=t.length);for(var c=s-n,l=0,h=c-1;l<c;h=l++){var u=t[l+n][0],d=t[l+n][1],f=t[h+n][0],p=t[h+n][1],y=d>r!=p>r&&i<(f-u)*(r-d)/(p-d)+u;y&&(o=!o)}return o},Js=Or,Vs=Lr;At.exports=function(e,t,n,s){return t.length>0&&Array.isArray(t[0])?Vs(e,t,n,s):Js(e,t,n,s)};At.exports.nested=Vs;At.exports.flat=Js;var Ir=At.exports;const ca=Nr(Ir);class Pr{constructor({canvas:e,sizes:t,scene:n,camera:s,postprocessing:i=!1,composer:r=null}){this.canvas=e,this.sizes=t,this.scene=n,this.camera=s,this.postprocessing=i,this.composer=r,this.setInstance()}setInstance(){this.instance=new Gi({alpha:!0,antialias:!0,canvas:this.canvas}),this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(this.sizes.pixelRatio)}resize(){this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(this.sizes.pixelRatio)}update(){this.postprocessing&&this.composer?this.composer.render():this.instance.render(this.scene,this.camera.instance)}destroy(){this.instance.dispose(),this.instance.forceContextLoss()}}class kn{constructor(e,t,n,s,i){this.sender=e,this.receiver=t,this.message=n,this.delay=s,this.data=i}toJSON(){return{type:this.constructor.name,sender:this.sender.uuid,receiver:this.receiver.uuid,message:this.message,delay:this.delay,data:this.data}}fromJSON(e){return this.sender=e.sender,this.receiver=e.receiver,this.message=e.message,this.delay=e.delay,this.data=e.data,this}resolveReferences(e){return this.sender=e.get(this.sender),this.receiver=e.get(this.receiver),this}}class W{static setLevel(e){Ue=e}static log(...e){Ue<=W.LEVEL.LOG&&console.log(...e)}static warn(...e){Ue<=W.LEVEL.WARN&&console.warn(...e)}static error(...e){Ue<=W.LEVEL.ERROR&&console.error(...e)}}W.LEVEL=Object.freeze({LOG:0,WARN:1,ERROR:2,SILENT:3});let Ue=W.LEVEL.WARN;class Cr{constructor(){this.delayedTelegrams=new Array}deliver(e){const t=e.receiver;return t.handleMessage(e)===!1&&W.warn("YUKA.MessageDispatcher: Message not handled by receiver: %o",t),this}dispatch(e,t,n,s,i){const r=new kn(e,t,n,s,i);return s<=0?this.deliver(r):this.delayedTelegrams.push(r),this}dispatchDelayedMessages(e){let t=this.delayedTelegrams.length;for(;t--;){const n=this.delayedTelegrams[t];n.delay-=e,n.delay<=0&&(this.deliver(n),this.delayedTelegrams.pop())}return this}clear(){return this.delayedTelegrams.length=0,this}toJSON(){const e={type:this.constructor.name,delayedTelegrams:new Array};for(let t=0,n=this.delayedTelegrams.length;t<n;t++){const s=this.delayedTelegrams[t];e.delayedTelegrams.push(s.toJSON())}return e}fromJSON(e){this.clear();const t=e.delayedTelegrams;for(let n=0,s=t.length;n<s;n++){const i=t[n],r=new kn().fromJSON(i);this.delayedTelegrams.push(r)}return this}resolveReferences(e){const t=this.delayedTelegrams;for(let n=0,s=t.length;n<s;n++)t[n].resolveReferences(e);return this}}const V=new Array;for(let a=0;a<256;a++)V[a]=(a<16?"0":"")+a.toString(16);class ee{static area(e,t,n){return(n.x-e.x)*(t.z-e.z)-(t.x-e.x)*(n.z-e.z)}static argmax(e){const t=Math.max(...e),n=[];for(let s=0,i=e.length;s<i;s++)e[s]===t&&n.push(s);return n}static choice(e,t=null){const n=Math.random();if(t===null)return e[Math.floor(Math.random()*e.length)];{let s=0;const i=e.map((r,o)=>(s+=t[o],s)).findIndex(r=>r>=n);return e[i]}}static clamp(e,t,n){return Math.max(t,Math.min(n,e))}static generateUUID(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(V[e&255]+V[e>>8&255]+V[e>>16&255]+V[e>>24&255]+"-"+V[t&255]+V[t>>8&255]+"-"+V[t>>16&15|64]+V[t>>24&255]+"-"+V[n&63|128]+V[n>>8&255]+"-"+V[n>>16&255]+V[n>>24&255]+V[s&255]+V[s>>8&255]+V[s>>16&255]+V[s>>24&255]).toUpperCase()}static randFloat(e,t){return e+Math.random()*(t-e)}static randInt(e,t){return e+Math.floor(Math.random()*(t-e+1))}}class w{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new this.constructor().copy(this)}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.x/=e,this.y/=e,this.z/=e,this}divideVectors(e,t){return this.x=e.x/t.x,this.y=e.y/t.y,this.z=e.z/t.z,this}reflect(e){return this.sub(zr.copy(e).multiplyScalar(2*this.dot(e)))}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){const t=this.x,n=this.y,s=this.z;return this.x=n*e.z-s*e.y,this.y=s*e.x-t*e.z,this.z=t*e.y-n*e.x,this}crossVectors(e,t){const n=e.x,s=e.y,i=e.z,r=t.x,o=t.y,c=t.z;return this.x=s*c-i*o,this.y=i*r-n*c,this.z=n*o-s*r,this}angleTo(e){const t=Math.sqrt(this.squaredLength()*e.squaredLength());if(t===0)return 0;const n=this.dot(e)/t;return Math.acos(ee.clamp(n,-1,1))}length(){return Math.sqrt(this.squaredLength())}squaredLength(){return this.dot(this)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}distanceTo(e){return Math.sqrt(this.squaredDistanceTo(e))}squaredDistanceTo(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return Math.abs(t)+Math.abs(n)+Math.abs(s)}normalize(){return this.divideScalar(this.length()||1)}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,i=e.elements,r=1/(i[3]*t+i[7]*n+i[11]*s+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*s+i[12])*r,this.y=(i[1]*t+i[5]*n+i[9]*s+i[13])*r,this.z=(i[2]*t+i[6]*n+i[10]*s+i[14])*r,this}applyRotation(e){const t=this.x,n=this.y,s=this.z,i=e.x,r=e.y,o=e.z,c=e.w,l=c*t+r*s-o*n,h=c*n+o*t-i*s,u=c*s+i*n-r*t,d=-i*t-r*n-o*s;return this.x=l*c+d*-i+h*-o-u*-r,this.y=h*c+d*-r+u*-i-l*-o,this.z=u*c+d*-o+l*-r-h*-i,this}extractPositionFromMatrix(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}transformDirection(e){const t=this.x,n=this.y,s=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*s,this.y=i[1]*t+i[5]*n+i[9]*s,this.z=i[2]*t+i[6]*n+i[10]*s,this.normalize()}fromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}fromMatrix4Column(e,t){return this.fromArray(e.elements,t*4)}fromSpherical(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}fromArray(e,t=0){return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this}toArray(e,t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}const zr=new w,Fn=new w(0,1,0),Bn=new w,Ee=new w,Gn=new w,Un=new w,Lt=[2,2,1],It=[1,0,0];class wn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,s,i,r,o,c,l){const h=this.elements;return h[0]=e,h[3]=t,h[6]=n,h[1]=s,h[4]=i,h[7]=r,h[2]=o,h[5]=c,h[8]=l,this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}clone(){return new this.constructor().copy(this)}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,i=this.elements,r=n[0],o=n[3],c=n[6],l=n[1],h=n[4],u=n[7],d=n[2],f=n[5],p=n[8],y=s[0],g=s[3],m=s[6],x=s[1],S=s[4],A=s[7],_=s[2],E=s[5],b=s[8];return i[0]=r*y+o*x+c*_,i[3]=r*g+o*S+c*E,i[6]=r*m+o*A+c*b,i[1]=l*y+h*x+u*_,i[4]=l*g+h*S+u*E,i[7]=l*m+h*A+u*b,i[2]=d*y+f*x+p*_,i[5]=d*g+f*S+p*E,i[8]=d*m+f*A+p*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}extractBasis(e,t,n){return e.fromMatrix3Column(this,0),t.fromMatrix3Column(this,1),n.fromMatrix3Column(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,e.y,t.y,n.y,e.z,t.z,n.z),this}lookAt(e,t,n){return Bn.crossVectors(n,e).normalize(),Ee.crossVectors(Fn,t).normalize(),Ee.squaredLength()===0&&(Un.copy(t).addScalar(Number.EPSILON),Ee.crossVectors(Fn,Un).normalize()),Gn.crossVectors(t,Ee).normalize(),ge.makeBasis(Ee,Gn,t),He.makeBasis(Bn,n,e),this.multiplyMatrices(ge,He.transpose()),this}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getElementIndex(e,t){return e*3+t}frobeniusNorm(){const e=this.elements;let t=0;for(let n=0;n<9;n++)t+=e[n]*e[n];return Math.sqrt(t)}offDiagonalFrobeniusNorm(){const e=this.elements;let t=0;for(let n=0;n<3;n++){const s=e[this.getElementIndex(Lt[n],It[n])];t+=2*s*s}return Math.sqrt(t)}eigenDecomposition(e){let t=0,n=0;const s=10;e.unitary.identity(),e.diagonal.copy(this);const i=e.unitary,r=e.diagonal,o=Number.EPSILON*r.frobeniusNorm();for(;n<s&&r.offDiagonalFrobeniusNorm()>o;)r.shurDecomposition(ge),He.copy(ge).transpose(),r.multiply(ge),r.premultiply(He),i.multiply(ge),++t>2&&(n++,t=0);return e}shurDecomposition(e){let t=0,n=1;const s=this.elements;for(let l=0;l<3;l++){const h=Math.abs(s[this.getElementIndex(Lt[l],It[l])]);h>t&&(t=h,n=l)}let i=1,r=0;const o=It[n],c=Lt[n];if(Math.abs(s[this.getElementIndex(c,o)])>Number.EPSILON){const l=s[this.getElementIndex(c,c)],h=s[this.getElementIndex(o,o)],u=s[this.getElementIndex(c,o)],d=(l-h)/2/u;let f;d<0?f=-1/(-d+Math.sqrt(1+d*d)):f=1/(d+Math.sqrt(1+d*d)),i=1/Math.sqrt(1+f*f),r=f*i}return e.identity(),e.elements[this.getElementIndex(o,o)]=i,e.elements[this.getElementIndex(c,c)]=i,e.elements[this.getElementIndex(c,o)]=r,e.elements[this.getElementIndex(o,c)]=-r,e}fromQuaternion(e){const t=this.elements,n=e.x,s=e.y,i=e.z,r=e.w,o=n+n,c=s+s,l=i+i,h=n*o,u=n*c,d=n*l,f=s*c,p=s*l,y=i*l,g=r*o,m=r*c,x=r*l;return t[0]=1-(f+y),t[3]=u-x,t[6]=d+m,t[1]=u+x,t[4]=1-(h+y),t[7]=p-g,t[2]=d-m,t[5]=p+g,t[8]=1-(h+f),this}fromMatrix4(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],this}fromArray(e,t=0){const n=this.elements;for(let s=0;s<9;s++)n[s]=e[s+t];return this}toArray(e,t=0){const n=this.elements;return e[t+0]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}}const ge=new wn,He=new wn,Je=new wn,Pt=new w;class ft{constructor(e=0,t=0,n=0,s=1){this.x=e,this.y=t,this.z=n,this.w=s}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}clone(){return new this.constructor().copy(this)}inverse(){return this.conjugate().normalize()}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}length(){return Math.sqrt(this.squaredLength())}squaredLength(){return this.dot(this)}normalize(){let e=this.length();return e===0?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e.x,s=e.y,i=e.z,r=e.w,o=t.x,c=t.y,l=t.z,h=t.w;return this.x=n*h+r*o+s*l-i*c,this.y=s*h+r*c+i*o-n*l,this.z=i*h+r*l+n*c-s*o,this.w=r*h-n*o-s*c-i*l,this}angleTo(e){return 2*Math.acos(Math.abs(ee.clamp(this.dot(e),-1,1)))}rotateTo(e,t,n=1e-4){const s=this.angleTo(e);if(s<n)return!0;const i=Math.min(1,t/s);return this.slerp(e,i),!1}lookAt(e,t,n){Je.lookAt(e,t,n),this.fromMatrix3(Je)}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this.x,s=this.y,i=this.z,r=this.w;let o=r*e.w+n*e.x+s*e.y+i*e.z;if(o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),o>=1)return this.w=r,this.x=n,this.y=s,this.z=i,this;const c=Math.sqrt(1-o*o);if(Math.abs(c)<.001)return this.w=.5*(r+this.w),this.x=.5*(n+this.x),this.y=.5*(s+this.y),this.z=.5*(i+this.z),this;const l=Math.atan2(c,o),h=Math.sin((1-t)*l)/c,u=Math.sin(t*l)/c;return this.w=r*h+this.w*u,this.x=n*h+this.x*u,this.y=s*h+this.y*u,this.z=i*h+this.z*u,this}extractRotationFromMatrix(e){const t=Je.elements,n=e.elements,s=1/Pt.fromMatrix4Column(e,0).length(),i=1/Pt.fromMatrix4Column(e,1).length(),r=1/Pt.fromMatrix4Column(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=n[4]*i,t[4]=n[5]*i,t[5]=n[6]*i,t[6]=n[8]*r,t[7]=n[9]*r,t[8]=n[10]*r,this.fromMatrix3(Je),this}fromEuler(e,t,n){const s=Math.cos(t/2),i=Math.cos(e/2),r=Math.cos(n/2),o=Math.sin(t/2),c=Math.sin(e/2),l=Math.sin(n/2);return this.w=s*i*r+o*c*l,this.x=s*c*r+o*i*l,this.y=o*i*r-s*c*l,this.z=s*i*l-o*c*r,this}toEuler(e){const t=-2*(this.y*this.z-this.x*this.w);return Math.abs(t)>.9999?(e.x=Math.PI*.5*t,e.y=Math.atan2(this.x*this.z+this.w*this.y,.5-this.x*this.x-this.y*this.y),e.z=0):(e.x=Math.asin(t),e.y=Math.atan2(this.x*this.z+this.w*this.y,.5-this.x*this.x-this.y*this.y),e.z=Math.atan2(this.x*this.y+this.w*this.z,.5-this.x*this.x-this.z*this.z)),e}fromMatrix3(e){const t=e.elements,n=t[0],s=t[3],i=t[6],r=t[1],o=t[4],c=t[7],l=t[2],h=t[5],u=t[8],d=n+o+u;if(d>0){let f=.5/Math.sqrt(d+1);this.w=.25/f,this.x=(h-c)*f,this.y=(i-l)*f,this.z=(r-s)*f}else if(n>o&&n>u){let f=2*Math.sqrt(1+n-o-u);this.w=(h-c)/f,this.x=.25*f,this.y=(s+r)/f,this.z=(i+l)/f}else if(o>u){let f=2*Math.sqrt(1+o-n-u);this.w=(i-l)/f,this.x=(s+r)/f,this.y=.25*f,this.z=(c+h)/f}else{let f=2*Math.sqrt(1+u-n-o);this.w=(r-s)/f,this.x=(i+l)/f,this.y=(c+h)/f,this.z=.25*f}return this}fromArray(e,t=0){return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e,t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}class De{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,s,i,r,o,c,l,h,u,d,f,p,y,g){const m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=s,m[1]=i,m[5]=r,m[9]=o,m[13]=c,m[2]=l,m[6]=h,m[10]=u,m[14]=d,m[3]=f,m[7]=p,m[11]=y,m[15]=g,this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}clone(){return new this.constructor().copy(this)}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,i=this.elements,r=n[0],o=n[4],c=n[8],l=n[12],h=n[1],u=n[5],d=n[9],f=n[13],p=n[2],y=n[6],g=n[10],m=n[14],x=n[3],S=n[7],A=n[11],_=n[15],E=s[0],b=s[4],R=s[8],M=s[12],I=s[1],v=s[5],U=s[9],C=s[13],P=s[2],T=s[6],N=s[10],D=s[14],H=s[3],J=s[7],te=s[11],q=s[15];return i[0]=r*E+o*I+c*P+l*H,i[4]=r*b+o*v+c*T+l*J,i[8]=r*R+o*U+c*N+l*te,i[12]=r*M+o*C+c*D+l*q,i[1]=h*E+u*I+d*P+f*H,i[5]=h*b+u*v+d*T+f*J,i[9]=h*R+u*U+d*N+f*te,i[13]=h*M+u*C+d*D+f*q,i[2]=p*E+y*I+g*P+m*H,i[6]=p*b+y*v+g*T+m*J,i[10]=p*R+y*U+g*N+m*te,i[14]=p*M+y*C+g*D+m*q,i[3]=x*E+S*I+A*P+_*H,i[7]=x*b+S*v+A*T+_*J,i[11]=x*R+S*U+A*N+_*te,i[15]=x*M+S*C+A*D+_*q,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}extractBasis(e,t,n){return e.fromMatrix4Column(this,0),t.fromMatrix4Column(this,1),n.fromMatrix4Column(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}compose(e,t,n){return this.fromQuaternion(t),this.scale(n),this.setPosition(e),this}scale(e){const t=this.elements,n=e.x,s=e.y,i=e.z;return t[0]*=n,t[4]*=s,t[8]*=i,t[1]*=n,t[5]*=s,t[9]*=i,t[2]*=n,t[6]*=s,t[10]*=i,t[3]*=n,t[7]*=s,t[11]*=i,this}setPosition(e){const t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}getInverse(e){const t=this.elements,n=e.elements,s=t[0],i=t[1],r=t[2],o=t[3],c=t[4],l=t[5],h=t[6],u=t[7],d=t[8],f=t[9],p=t[10],y=t[11],g=t[12],m=t[13],x=t[14],S=t[15],A=f*x*u-m*p*u+m*h*y-l*x*y-f*h*S+l*p*S,_=g*p*u-d*x*u-g*h*y+c*x*y+d*h*S-c*p*S,E=d*m*u-g*f*u+g*l*y-c*m*y-d*l*S+c*f*S,b=g*f*h-d*m*h-g*l*p+c*m*p+d*l*x-c*f*x,R=s*A+i*_+r*E+o*b;if(R===0)return e.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/R;return n[0]=A*M,n[1]=(m*p*o-f*x*o-m*r*y+i*x*y+f*r*S-i*p*S)*M,n[2]=(l*x*o-m*h*o+m*r*u-i*x*u-l*r*S+i*h*S)*M,n[3]=(f*h*o-l*p*o-f*r*u+i*p*u+l*r*y-i*h*y)*M,n[4]=_*M,n[5]=(d*x*o-g*p*o+g*r*y-s*x*y-d*r*S+s*p*S)*M,n[6]=(g*h*o-c*x*o-g*r*u+s*x*u+c*r*S-s*h*S)*M,n[7]=(c*p*o-d*h*o+d*r*u-s*p*u-c*r*y+s*h*y)*M,n[8]=E*M,n[9]=(g*f*o-d*m*o-g*i*y+s*m*y+d*i*S-s*f*S)*M,n[10]=(c*m*o-g*l*o+g*i*u-s*m*u-c*i*S+s*l*S)*M,n[11]=(d*l*o-c*f*o-d*i*u+s*f*u+c*i*y-s*l*y)*M,n[12]=b*M,n[13]=(d*m*r-g*f*r+g*i*p-s*m*p-d*i*x+s*f*x)*M,n[14]=(g*l*r-c*m*r-g*i*h+s*m*h+c*i*x-s*l*x)*M,n[15]=(c*f*r-d*l*r+d*i*h-s*f*h-c*i*p+s*l*p)*M,e}getMaxScale(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}fromQuaternion(e){const t=this.elements,n=e.x,s=e.y,i=e.z,r=e.w,o=n+n,c=s+s,l=i+i,h=n*o,u=n*c,d=n*l,f=s*c,p=s*l,y=i*l,g=r*o,m=r*c,x=r*l;return t[0]=1-(f+y),t[4]=u-x,t[8]=d+m,t[1]=u+x,t[5]=1-(h+y),t[9]=p-g,t[2]=d-m,t[6]=p+g,t[10]=1-(h+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}fromMatrix3(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=0,t[4]=n[3],t[5]=n[4],t[6]=n[5],t[7]=0,t[8]=n[6],t[9]=n[7],t[10]=n[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}fromArray(e,t=0){const n=this.elements;for(let s=0;s<16;s++)n[s]=e[s+t];return this}toArray(e,t=0){const n=this.elements;return e[t+0]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}}const Ve=new ft,ae=new w,qe=new w,me=new ft;class An{constructor(){this.name="",this.active=!0,this.children=new Array,this.parent=null,this.neighbors=new Array,this.neighborhoodRadius=1,this.updateNeighborhood=!1,this.position=new w,this.rotation=new ft,this.scale=new w(1,1,1),this.forward=new w(0,0,1),this.up=new w(0,1,0),this.boundingRadius=0,this.maxTurnRate=Math.PI,this.canActivateTrigger=!0,this.manager=null,this._localMatrix=new De,this._worldMatrix=new De,this._cache={position:new w,rotation:new ft,scale:new w(1,1,1)},this._renderComponent=null,this._renderComponentCallback=null,this._started=!1,this._uuid=null,this._worldMatrixDirty=!1}get worldMatrix(){return this._updateWorldMatrix(),this._worldMatrix}get uuid(){return this._uuid===null&&(this._uuid=ee.generateUUID()),this._uuid}start(){return this}update(){return this}add(e){return e.parent!==null&&e.parent.remove(e),this.children.push(e),e.parent=this,this}remove(e){const t=this.children.indexOf(e);return this.children.splice(t,1),e.parent=null,this}getDirection(e){return e.copy(this.forward).applyRotation(this.rotation).normalize()}lookAt(e){const t=this.parent;return t!==null?(this.getWorldPosition(qe),ae.subVectors(e,qe).normalize(),this.rotation.lookAt(this.forward,ae,this.up),me.extractRotationFromMatrix(t.worldMatrix).inverse(),this.rotation.premultiply(me)):(ae.subVectors(e,this.position).normalize(),this.rotation.lookAt(this.forward,ae,this.up)),this}rotateTo(e,t,n=1e-4){const s=this.parent;return s!==null?(this.getWorldPosition(qe),ae.subVectors(e,qe).normalize(),Ve.lookAt(this.forward,ae,this.up),me.extractRotationFromMatrix(s.worldMatrix).inverse(),Ve.premultiply(me)):(ae.subVectors(e,this.position).normalize(),Ve.lookAt(this.forward,ae,this.up)),this.rotation.rotateTo(Ve,this.maxTurnRate*t,n)}getWorldDirection(e){return me.extractRotationFromMatrix(this.worldMatrix),e.copy(this.forward).applyRotation(me).normalize()}getWorldPosition(e){return e.extractPositionFromMatrix(this.worldMatrix)}setRenderComponent(e,t){return this._renderComponent=e,this._renderComponentCallback=t,this}handleMessage(){return!1}lineOfSightTest(){return null}sendMessage(e,t,n=0,s=null){return this.manager!==null?this.manager.sendMessage(this,e,t,n,s):W.error("YUKA.GameEntity: The game entity must be added to a manager in order to send a message."),this}toJSON(){return{type:this.constructor.name,uuid:this.uuid,name:this.name,active:this.active,children:Hn(this.children),parent:this.parent!==null?this.parent.uuid:null,neighbors:Hn(this.neighbors),neighborhoodRadius:this.neighborhoodRadius,updateNeighborhood:this.updateNeighborhood,position:this.position.toArray(new Array),rotation:this.rotation.toArray(new Array),scale:this.scale.toArray(new Array),forward:this.forward.toArray(new Array),up:this.up.toArray(new Array),boundingRadius:this.boundingRadius,maxTurnRate:this.maxTurnRate,canActivateTrigger:this.canActivateTrigger,worldMatrix:this.worldMatrix.toArray(new Array),_localMatrix:this._localMatrix.toArray(new Array),_cache:{position:this._cache.position.toArray(new Array),rotation:this._cache.rotation.toArray(new Array),scale:this._cache.scale.toArray(new Array)},_started:this._started}}fromJSON(e){return this.name=e.name,this.active=e.active,this.neighborhoodRadius=e.neighborhoodRadius,this.updateNeighborhood=e.updateNeighborhood,this.position.fromArray(e.position),this.rotation.fromArray(e.rotation),this.scale.fromArray(e.scale),this.forward.fromArray(e.forward),this.up.fromArray(e.up),this.boundingRadius=e.boundingRadius,this.maxTurnRate=e.maxTurnRate,this.canActivateTrigger=e.canActivateTrigger,this.children=e.children.slice(),this.neighbors=e.neighbors.slice(),this.parent=e.parent,this._localMatrix.fromArray(e._localMatrix),this._worldMatrix.fromArray(e.worldMatrix),this._cache.position.fromArray(e._cache.position),this._cache.rotation.fromArray(e._cache.rotation),this._cache.scale.fromArray(e._cache.scale),this._started=e._started,this._uuid=e.uuid,this}resolveReferences(e){const t=this.neighbors;for(let s=0,i=t.length;s<i;s++)t[s]=e.get(t[s]);const n=this.children;for(let s=0,i=n.length;s<i;s++)n[s]=e.get(n[s]);return this.parent=e.get(this.parent)||null,this}_updateMatrix(){const e=this._cache;e.position.equals(this.position)&&e.rotation.equals(this.rotation)&&e.scale.equals(this.scale)||(this._localMatrix.compose(this.position,this.rotation,this.scale),e.position.copy(this.position),e.rotation.copy(this.rotation),e.scale.copy(this.scale),this._worldMatrixDirty=!0)}_updateWorldMatrix(){const e=this.parent;if(e!==null&&e._updateWorldMatrix(),this._updateMatrix(),this._worldMatrixDirty===!0){e===null?this._worldMatrix.copy(this._localMatrix):this._worldMatrix.multiplyMatrices(this.parent._worldMatrix,this._localMatrix),this._worldMatrixDirty=!1;const t=this.children;for(let n=0,s=t.length;n<s;n++){const i=t[n];i._worldMatrixDirty=!0}}}updateWorldMatrix(){return console.warn("GameEntity: .updateWorldMatrix() has been removed. World matrices are automatically updated on access."),this}}function Hn(a){const e=new Array;for(let t=0,n=a.length;t<n;t++)e.push(a[t].uuid);return e}const Jn=new w,Ct=new w;class qs extends An{constructor(){super(),this.velocity=new w,this.maxSpeed=1,this.updateOrientation=!0}update(e){return this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed)),Jn.copy(this.velocity).multiplyScalar(e),Ct.copy(this.position).add(Jn),this.updateOrientation&&this.getSpeedSquared()>1e-8&&this.lookAt(Ct),this.position.copy(Ct),this}getSpeed(){return this.velocity.length()}getSpeedSquared(){return this.velocity.squaredLength()}toJSON(){const e=super.toJSON();return e.velocity=this.velocity.toArray(new Array),e.maxSpeed=this.maxSpeed,e.updateOrientation=this.updateOrientation,e}fromJSON(e){return super.fromJSON(e),this.velocity.fromArray(e.velocity),this.maxSpeed=e.maxSpeed,this.updateOrientation=e.updateOrientation,this}}class j{constructor(){this.active=!0,this.weight=1}calculate(){}toJSON(){return{type:this.constructor.name,active:this.active,weight:this.weight}}fromJSON(e){return this.active=e.active,this.weight=e.weight,this}resolveReferences(){}}const Ke=new w,We=new w;class Dr extends j{constructor(){super()}calculate(e,t){Ke.set(0,0,0);const n=e.neighbors;for(let s=0,i=n.length;s<i;s++)n[s].getDirection(We),Ke.add(We);return n.length>0&&(Ke.divideScalar(n.length),e.getDirection(We),t.subVectors(Ke,We)),t}}const zt=new w,Dt=new w;class Tt extends j{constructor(e=new w,t=3,n=0){super(),this.target=e,this.deceleration=t,this.tolerance=n}calculate(e,t){const n=this.target,s=this.deceleration;Dt.subVectors(n,e.position);const i=Dt.length();if(i>this.tolerance){let r=i/s;r=Math.min(r,e.maxSpeed),zt.copy(Dt).multiplyScalar(r/i)}else zt.set(0,0,0);return t.subVectors(zt,e.velocity)}toJSON(){const e=super.toJSON();return e.target=this.target.toArray(new Array),e.deceleration=this.deceleration,e}fromJSON(e){return super.fromJSON(e),this.target.fromArray(e.target),this.deceleration=e.deceleration,this}}const kt=new w;class St extends j{constructor(e=new w){super(),this.target=e}calculate(e,t){const n=this.target;return kt.subVectors(n,e.position).normalize(),kt.multiplyScalar(e.maxSpeed),t.subVectors(kt,e.velocity)}toJSON(){const e=super.toJSON();return e.target=this.target.toArray(new Array),e}fromJSON(e){return super.fromJSON(e),this.target.fromArray(e.target),this}}const je=new w;class kr extends j{constructor(){super(),this._seek=new St}calculate(e,t){je.set(0,0,0);const n=e.neighbors;for(let s=0,i=n.length;s<i;s++){const r=n[s];je.add(r.position)}return n.length>0&&(je.divideScalar(n.length),this._seek.target=je,this._seek.calculate(e,t),t.normalize()),t}}const be=new w;class Ks extends j{constructor(e=new w,t=10){super(),this.target=e,this.panicDistance=t}calculate(e,t){const n=this.target;return e.position.squaredDistanceTo(n)<=this.panicDistance*this.panicDistance&&(be.subVectors(e.position,n).normalize(),be.squaredLength()===0&&be.set(0,0,1),be.multiplyScalar(e.maxSpeed),t.subVectors(be,e.velocity)),t}toJSON(){const e=super.toJSON();return e.target=this.target.toArray(new Array),e.panicDistance=this.panicDistance,e}fromJSON(e){return super.fromJSON(e),this.target.fromArray(e.target),this.panicDistance=e.panicDistance,this}}const Vn=new w,qn=new w,Kn=new w;class Fr extends j{constructor(e=null,t=10,n=1){super(),this.pursuer=e,this.panicDistance=t,this.predictionFactor=n,this._flee=new Ks}calculate(e,t){const n=this.pursuer;Vn.subVectors(n.position,e.position);let s=Vn.length()/(e.maxSpeed+n.getSpeed());return s*=this.predictionFactor,qn.copy(n.velocity).multiplyScalar(s),Kn.addVectors(n.position,qn),this._flee.target=Kn,this._flee.panicDistance=this.panicDistance,this._flee.calculate(e,t),t}toJSON(){const e=super.toJSON();return e.pursuer=this.pursuer?this.pursuer.uuid:null,e.panicDistance=this.panicDistance,e.predictionFactor=this.predictionFactor,e}fromJSON(e){return super.fromJSON(e),this.pursuer=e.pursuer,this.panicDistance=e.panicDistance,this.predictionFactor=e.predictionFactor,this}resolveReferences(e){this.pursuer=e.get(this.pursuer)||null}}class Br{constructor(){this.loop=!1,this._waypoints=new Array,this._index=0}add(e){return this._waypoints.push(e),this}clear(){return this._waypoints.length=0,this._index=0,this}current(){return this._waypoints[this._index]}finished(){const e=this._waypoints.length-1;return this.loop===!0?!1:this._index===e}advance(){return this._index++,this._index===this._waypoints.length&&(this.loop===!0?this._index=0:this._index--),this}toJSON(){const e={type:this.constructor.name,loop:this.loop,_waypoints:new Array,_index:this._index},t=this._waypoints;for(let n=0,s=t.length;n<s;n++){const i=t[n];e._waypoints.push(i.toArray(new Array))}return e}fromJSON(e){this.loop=e.loop,this._index=e._index;const t=e._waypoints;for(let n=0,s=t.length;n<s;n++){const i=t[n];this._waypoints.push(new w().fromArray(i))}return this}}class Gr extends j{constructor(e=new Br,t=1){super(),this.path=e,this.nextWaypointDistance=t,this._arrive=new Tt,this._seek=new St}calculate(e,t){const n=this.path;n.current().squaredDistanceTo(e.position)<this.nextWaypointDistance*this.nextWaypointDistance&&n.advance();const i=n.current();return n.finished()===!0?(this._arrive.target=i,this._arrive.calculate(e,t)):(this._seek.target=i,this._seek.calculate(e,t)),t}toJSON(){const e=super.toJSON();return e.path=this.path.toJSON(),e.nextWaypointDistance=this.nextWaypointDistance,e}fromJSON(e){return super.fromJSON(e),this.path.fromJSON(e.path),this.nextWaypointDistance=e.nextWaypointDistance,this}}const Xe=new w,$e=new w,Wn=new w,jn=new w;class Ur extends j{constructor(e=null,t=null,n=3){super(),this.entity1=e,this.entity2=t,this.deceleration=n,this._arrive=new Tt}calculate(e,t){const n=this.entity1,s=this.entity2;Xe.addVectors(n.position,s.position).multiplyScalar(.5);const i=e.position.distanceTo(Xe)/e.maxSpeed;return $e.copy(n.velocity).multiplyScalar(i),Wn.addVectors(n.position,$e),$e.copy(s.velocity).multiplyScalar(i),jn.addVectors(s.position,$e),Xe.addVectors(Wn,jn).multiplyScalar(.5),this._arrive.deceleration=this.deceleration,this._arrive.target=Xe,this._arrive.calculate(e,t),t}toJSON(){const e=super.toJSON();return e.entity1=this.entity1?this.entity1.uuid:null,e.entity2=this.entity2?this.entity2.uuid:null,e.deceleration=this.deceleration,e}fromJSON(e){return super.fromJSON(e),this.entity1=e.entity1,this.entity2=e.entity2,this.deceleration=e.deceleration,this}resolveReferences(e){this.entity1=e.get(this.entity1)||null,this.entity2=e.get(this.entity2)||null}}const $=new w,ve=new w,ce=new w,ie=[new w,new w,new w,new w,new w,new w,new w,new w];class Tn{constructor(e=new w,t=new w){this.min=e,this.max=t}set(e,t){return this.min=e,this.max=t,this}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}clone(){return new this.constructor().copy(this)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max),t}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}expand(e){return this.min.min(e),this.max.max(e),this}getCenter(e){return e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return e.subVectors(this.max,this.min)}intersectsAABB(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsBoundingSphere(e){return this.clampPoint(e.center,$),$.squaredDistanceTo(e.center)<=e.radius*e.radius}intersectsPlane(e){const t=e.normal;this.getCenter(ve),ce.subVectors(this.max,ve);const n=ce.x*Math.abs(t.x)+ce.y*Math.abs(t.y)+ce.z*Math.abs(t.z),s=e.distanceToPoint(ve);return Math.abs(s)<=n}getNormalFromSurfacePoint(e,t){t.set(0,0,0);let n,s=1/0;return this.getCenter(ve),this.getSize(ce),$.copy(e).sub(ve),n=Math.abs(ce.x-Math.abs($.x)),n<s&&(s=n,t.set(1*Math.sign($.x),0,0)),n=Math.abs(ce.y-Math.abs($.y)),n<s&&(s=n,t.set(0,1*Math.sign($.y),0)),n=Math.abs(ce.z-Math.abs($.z)),n<s&&t.set(0,0,1*Math.sign($.z)),t}fromCenterAndSize(e,t){return $.copy(t).multiplyScalar(.5),this.min.copy(e).sub($),this.max.copy(e).add($),this}fromPoints(e){this.min.set(1/0,1/0,1/0),this.max.set(-1/0,-1/0,-1/0);for(let t=0,n=e.length;t<n;t++)this.expand(e[t]);return this}applyMatrix4(e){const t=this.min,n=this.max;return ie[0].set(t.x,t.y,t.z).applyMatrix4(e),ie[1].set(t.x,t.y,n.z).applyMatrix4(e),ie[2].set(t.x,n.y,t.z).applyMatrix4(e),ie[3].set(t.x,n.y,n.z).applyMatrix4(e),ie[4].set(n.x,t.y,t.z).applyMatrix4(e),ie[5].set(n.x,t.y,n.z).applyMatrix4(e),ie[6].set(n.x,n.y,t.z).applyMatrix4(e),ie[7].set(n.x,n.y,n.z).applyMatrix4(e),this.fromPoints(ie)}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{type:this.constructor.name,min:this.min.toArray(new Array),max:this.max.toArray(new Array)}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Ft=new Tn;class Mt{constructor(e=new w,t=0){this.center=e,this.radius=t}set(e,t){return this.center=e,this.radius=t,this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}clone(){return new this.constructor().copy(this)}clampPoint(e,t){return t.copy(e),this.center.squaredDistanceTo(e)>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}containsPoint(e){return e.squaredDistanceTo(this.center)<=this.radius*this.radius}intersectsBoundingSphere(e){const t=this.radius+e.radius;return e.center.squaredDistanceTo(this.center)<=t*t}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}getNormalFromSurfacePoint(e,t){return t.subVectors(e,this.center).normalize()}fromPoints(e){return Ft.fromPoints(e),Ft.getCenter(this.center),this.radius=this.center.distanceTo(Ft.max),this}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScale(),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}toJSON(){return{type:this.constructor.name,center:this.center.toArray(new Array),radius:this.radius}}fromJSON(e){return this.center.fromArray(e.center),this.radius=e.radius,this}}const Y=new w,Bt=new w,Ye=new w,Gt=new w,Xn=new w,Qe=new De,Hr=new De,$n=new Tn;class Ws{constructor(e=new w,t=new w){this.origin=e,this.direction=t}set(e,t){return this.origin=e,this.direction=t,this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}clone(){return new this.constructor().copy(this)}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}intersectBoundingSphere(e,t){Y.subVectors(e.center,this.origin);const n=Y.dot(this.direction),s=Y.dot(Y)-n*n,i=e.radius*e.radius;if(s>i)return null;const r=Math.sqrt(i-s),o=n-r,c=n+r;return o<0&&c<0?null:o<0?this.at(c,t):this.at(o,t)}intersectsBoundingSphere(e){const t=new w;let n;const s=t.subVectors(e.center,this.origin).dot(this.direction);return s<0?n=this.origin.squaredDistanceTo(e.center):(t.copy(this.direction).multiplyScalar(s).add(this.origin),n=t.squaredDistanceTo(e.center)),n<=e.radius*e.radius}intersectAABB(e,t){let n,s,i,r,o,c;const l=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,s=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,s=(e.min.x-d.x)*l),h>=0?(i=(e.min.y-d.y)*h,r=(e.max.y-d.y)*h):(i=(e.max.y-d.y)*h,r=(e.min.y-d.y)*h),n>r||i>s||((i>n||n!==n)&&(n=i),(r<s||s!==s)&&(s=r),u>=0?(o=(e.min.z-d.z)*u,c=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,c=(e.min.z-d.z)*u),n>c||o>s)||((o>n||n!==n)&&(n=o),(c<s||s!==s)&&(s=c),s<0)?null:this.at(n>=0?n:s,t)}intersectsAABB(e){return this.intersectAABB(e,Y)!==null}intersectPlane(e,t){let n;const s=e.normal.dot(this.direction);if(s===0)if(e.distanceToPoint(this.origin)===0)n=0;else return null;else n=-(this.origin.dot(e.normal)+e.constant)/s;return n>=0?this.at(n,t):null}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectOBB(e,t){return e.getSize(Xn),$n.fromCenterAndSize(Y.set(0,0,0),Xn),Qe.fromMatrix3(e.rotation),Qe.setPosition(e.center),Yn.copy(this).applyMatrix4(Qe.getInverse(Hr)),Yn.intersectAABB($n,t)?t.applyMatrix4(Qe):null}intersectsOBB(e){return this.intersectOBB(e,Y)!==null}intersectConvexHull(e,t){const n=e.faces;let s=-1/0,i=1/0;for(let r=0,o=n.length;r<o;r++){const l=n[r].plane,h=l.distanceToPoint(this.origin),u=l.normal.dot(this.direction);if(h>0&&u>=0)return null;const d=u!==0?-h/u:0;if(!(d<=0)&&(u>0?i=Math.min(d,i):s=Math.max(d,s),s>i))return null}return s!==-1/0?this.at(s,t):this.at(i,t),t}intersectsConvexHull(e){return this.intersectConvexHull(e,Y)!==null}intersectTriangle(e,t,n){const s=e.a,i=e.b,r=e.c;Bt.subVectors(i,s),Ye.subVectors(r,s),Gt.crossVectors(Bt,Ye);let o=this.direction.dot(Gt),c;if(o>0){if(t)return null;c=1}else if(o<0)c=-1,o=-o;else return null;Y.subVectors(this.origin,s);const l=c*this.direction.dot(Ye.crossVectors(Y,Ye));if(l<0)return null;const h=c*this.direction.dot(Bt.cross(Y));if(h<0||l+h>o)return null;const u=-c*Y.dot(Gt);return u<0?null:this.at(u/o,n)}intersectBVH(e,t){return e.root.intersectRay(this,t)}intersectsBVH(e){return e.root.intersectsRay(this)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}const Yn=new Ws,Qn=new De,ye=new w,Ze=new w,Ut=new w,Ht=new Mt,Jr=new Ws(new w(0,0,0),new w(0,0,1));class Vr extends j{constructor(e=new Array){super(),this.obstacles=e,this.brakingWeight=.2,this.dBoxMinLength=4}calculate(e,t){const n=this.obstacles;let s=null,i=1/0;const r=this.dBoxMinLength+e.getSpeed()/e.maxSpeed*this.dBoxMinLength;e.worldMatrix.getInverse(Qn);for(let o=0,c=n.length;o<c;o++){const l=n[o];if(l!==e&&(ye.copy(l.position).applyMatrix4(Qn),ye.z>0&&Math.abs(ye.z)<r)){const h=l.boundingRadius+e.boundingRadius;Math.abs(ye.x)<h&&(Ht.center.copy(ye),Ht.radius=h,Jr.intersectBoundingSphere(Ht,Ut),Ut.z<i&&(i=Ut.z,s=l,Ze.copy(ye)))}}if(s!==null){const o=1+(r-Ze.z)/r;t.x=(s.boundingRadius-Ze.x)*o,t.z=(s.boundingRadius-Ze.z)*this.brakingWeight,t.applyRotation(e.rotation)}return t}toJSON(){const e=super.toJSON();e.obstacles=new Array,e.brakingWeight=this.brakingWeight,e.dBoxMinLength=this.dBoxMinLength;for(let t=0,n=this.obstacles.length;t<n;t++)e.obstacles.push(this.obstacles[t].uuid);return e}fromJSON(e){return super.fromJSON(e),this.obstacles=e.obstacles,this.brakingWeight=e.brakingWeight,this.dBoxMinLength=e.dBoxMinLength,this}resolveReferences(e){const t=this.obstacles;for(let n=0,s=t.length;n<s;n++)t[n]=e.get(t[n])}}const Jt=new w,Zn=new w,es=new w,ts=new w;class qr extends j{constructor(e=null,t=new w){super(),this.leader=e,this.offset=t,this._arrive=new Tt,this._arrive.deceleration=1.5}calculate(e,t){const n=this.leader,s=this.offset;Jt.copy(s).applyMatrix4(n.worldMatrix),Zn.subVectors(Jt,e.position);const i=Zn.length()/(e.maxSpeed+n.getSpeed());return es.copy(n.velocity).multiplyScalar(i),ts.addVectors(Jt,es),this._arrive.target=ts,this._arrive.calculate(e,t),t}toJSON(){const e=super.toJSON();return e.leader=this.leader?this.leader.uuid:null,e.offset=this.offset,e}fromJSON(e){return super.fromJSON(e),this.leader=e.leader,this.offset=e.offset,this}resolveReferences(e){this.leader=e.get(this.leader)||null}}const Vt=new w,qt=new w,ns=new w,ss=new w,is=new w;class Kr extends j{constructor(e=null,t=1){super(),this.evader=e,this.predictionFactor=t,this._seek=new St}calculate(e,t){const n=this.evader;Vt.subVectors(n.position,e.position),e.getDirection(qt),n.getDirection(ns);const s=Vt.dot(qt)>0,i=qt.dot(ns)<-.95;if(s===!0&&i===!0)return this._seek.target=n.position,this._seek.calculate(e,t),t;let r=Vt.length()/(e.maxSpeed+n.getSpeed());return r*=this.predictionFactor,ss.copy(n.velocity).multiplyScalar(r),is.addVectors(n.position,ss),this._seek.target=is,this._seek.calculate(e,t),t}toJSON(){const e=super.toJSON();return e.evader=this.evader?this.evader.uuid:null,e.predictionFactor=this.predictionFactor,e}fromJSON(e){return super.fromJSON(e),this.evader=e.evader,this.predictionFactor=e.predictionFactor,this}resolveReferences(e){this.evader=e.get(this.evader)||null}}const et=new w;class Wr extends j{constructor(){super()}calculate(e,t){const n=e.neighbors;for(let s=0,i=n.length;s<i;s++){const r=n[s];et.subVectors(e.position,r.position);let o=et.length();o===0&&(o=1e-4),et.normalize().divideScalar(o),t.add(et)}return t}}const tt=new w,Kt=new w;class jr extends j{constructor(e=1,t=5,n=5){super(),this.radius=e,this.distance=t,this.jitter=n,this._targetLocal=new w,Xr(this.radius,this._targetLocal)}calculate(e,t,n){const s=this.jitter*n;return Kt.x=ee.randFloat(-1,1)*s,Kt.z=ee.randFloat(-1,1)*s,this._targetLocal.add(Kt),this._targetLocal.normalize(),this._targetLocal.multiplyScalar(this.radius),tt.copy(this._targetLocal),tt.z+=this.distance,tt.applyMatrix4(e.worldMatrix),t.subVectors(tt,e.position),t}toJSON(){const e=super.toJSON();return e.radius=this.radius,e.distance=this.distance,e.jitter=this.jitter,e._targetLocal=this._targetLocal.toArray(new Array),e}fromJSON(e){return super.fromJSON(e),this.radius=e.radius,this.distance=e.distance,this.jitter=e.jitter,this._targetLocal.fromArray(e._targetLocal),this}}function Xr(a,e){const t=Math.random()*Math.PI*2;e.x=a*Math.cos(t),e.z=a*Math.sin(t)}const nt=new w;class rs{constructor(e){this.vehicle=e,this.behaviors=new Array,this._steeringForce=new w,this._typesMap=new Map}add(e){return this.behaviors.push(e),this}remove(e){const t=this.behaviors.indexOf(e);return this.behaviors.splice(t,1),this}clear(){return this.behaviors.length=0,this}calculate(e,t){return this._calculateByOrder(e),t.copy(this._steeringForce)}_accumulate(e){const t=this._steeringForce.length(),n=this.vehicle.maxForce-t;return n<=0?!1:(e.length()>n&&e.normalize().multiplyScalar(n),this._steeringForce.add(e),!0)}_calculateByOrder(e){const t=this.behaviors;this._steeringForce.set(0,0,0);for(let n=0,s=t.length;n<s;n++){const i=t[n];if(i.active===!0&&(nt.set(0,0,0),i.calculate(this.vehicle,nt,e),nt.multiplyScalar(i.weight),this._accumulate(nt)===!1))return}}toJSON(){const e={type:"SteeringManager",behaviors:new Array},t=this.behaviors;for(let n=0,s=t.length;n<s;n++){const i=t[n];e.behaviors.push(i.toJSON())}return e}fromJSON(e){this.clear();const t=e.behaviors;for(let n=0,s=t.length;n<s;n++){const i=t[n],r=i.type;let o;switch(r){case"SteeringBehavior":o=new j().fromJSON(i);break;case"AlignmentBehavior":o=new Dr().fromJSON(i);break;case"ArriveBehavior":o=new Tt().fromJSON(i);break;case"CohesionBehavior":o=new kr().fromJSON(i);break;case"EvadeBehavior":o=new Fr().fromJSON(i);break;case"FleeBehavior":o=new Ks().fromJSON(i);break;case"FollowPathBehavior":o=new Gr().fromJSON(i);break;case"InterposeBehavior":o=new Ur().fromJSON(i);break;case"ObstacleAvoidanceBehavior":o=new Vr().fromJSON(i);break;case"OffsetPursuitBehavior":o=new qr().fromJSON(i);break;case"PursuitBehavior":o=new Kr().fromJSON(i);break;case"SeekBehavior":o=new St().fromJSON(i);break;case"SeparationBehavior":o=new Wr().fromJSON(i);break;case"WanderBehavior":o=new jr().fromJSON(i);break;default:const c=this._typesMap.get(r);if(c!==void 0)o=new c().fromJSON(i);else{W.warn("YUKA.SteeringManager: Unsupported steering behavior type:",r);continue}}this.add(o)}return this}registerType(e,t){return this._typesMap.set(e,t),this}resolveReferences(e){const t=this.behaviors;for(let n=0,s=t.length;n<s;n++)t[n].resolveReferences(e);return this}}class $r{constructor(e=10){this.count=e,this._history=new Array,this._slot=0;for(let t=0;t<this.count;t++)this._history[t]=new w}calculate(e,t){t.set(0,0,0),this._slot===this.count&&(this._slot=0),this._history[this._slot].copy(e),this._slot++;for(let n=0;n<this.count;n++)t.add(this._history[n]);return t.divideScalar(this.count),t}toJSON(){const e={type:this.constructor.name,count:this.count,_history:new Array,_slot:this._slot},t=this._history;for(let n=0,s=t.length;n<s;n++){const i=t[n];e._history.push(i.toArray(new Array))}return e}fromJSON(e){this.count=e.count,this._slot=e._slot;const t=e._history;this._history.length=0;for(let n=0,s=t.length;n<s;n++){const i=t[n];this._history.push(new w().fromArray(i))}return this}}const os=new w,st=new w,as=new w,Re=new w,cs=new w;class Yr extends qs{constructor(){super(),this.mass=1,this.maxForce=100,this.steering=new rs(this),this.smoother=null}update(e){return this.steering.calculate(e,os),as.copy(os).divideScalar(this.mass),this.velocity.add(as.multiplyScalar(e)),this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed)),st.copy(this.velocity).multiplyScalar(e),Re.copy(this.position).add(st),this.updateOrientation===!0&&this.smoother===null&&this.getSpeedSquared()>1e-8&&this.lookAt(Re),this.position.copy(Re),this.updateOrientation===!0&&this.smoother!==null&&(this.smoother.calculate(this.velocity,cs),st.copy(cs).multiplyScalar(e),Re.copy(this.position).add(st),this.lookAt(Re)),this}toJSON(){const e=super.toJSON();return e.mass=this.mass,e.maxForce=this.maxForce,e.steering=this.steering.toJSON(),e.smoother=this.smoother?this.smoother.toJSON():null,e}fromJSON(e){return super.fromJSON(e),this.mass=e.mass,this.maxForce=e.maxForce,this.steering=new rs(this).fromJSON(e.steering),this.smoother=e.smoother?new $r().fromJSON(e.smoother):null,this}resolveReferences(e){super.resolveReferences(e),this.steering.resolveReferences(e)}}class pt{touching(){return!1}update(){return this}toJSON(){return{type:this.constructor.name}}fromJSON(){return this}}const hs=new Mt,ls=new w;class Qr extends pt{constructor(e=new w){super(),this.size=e,this._aabb=new Tn}touching(e){return hs.set(e.position,e.boundingRadius),this._aabb.intersectsBoundingSphere(hs)}update(e){return e.getWorldPosition(ls),this._aabb.fromCenterAndSize(ls,this.size),this}toJSON(){const e=super.toJSON();return e.size=this.size.toArray(new Array),e}fromJSON(e){return super.fromJSON(e),this.size.fromArray(e.size),this}}const Wt=new Mt;class Zr extends pt{constructor(e=0){super(),this.radius=e,this._boundingSphere=new Mt}touching(e){return e.getWorldPosition(Wt.center),Wt.radius=e.boundingRadius,this._boundingSphere.intersectsBoundingSphere(Wt)}update(e){return e.getWorldPosition(this._boundingSphere.center),this._boundingSphere.radius=this.radius,this}toJSON(){const e=super.toJSON();return e.radius=this.radius,e}fromJSON(e){return super.fromJSON(e),this.radius=e.radius,this}}class us extends An{constructor(e=new pt){super(),this.region=e,this.canActivateTrigger=!1,this._typesMap=new Map}check(e){return this.region.touching(e)===!0&&this.execute(e),this}execute(){}updateRegion(){return this.region.update(this),this}toJSON(){const e=super.toJSON();return e.region=this.region.toJSON(),e}fromJSON(e){super.fromJSON(e);const t=e.region;let n=t.type;switch(n){case"TriggerRegion":this.region=new pt().fromJSON(t);break;case"RectangularTriggerRegion":this.region=new Qr().fromJSON(t);break;case"SphericalTriggerRegion":this.region=new Zr().fromJSON(t);break;default:const s=this._typesMap.get(n);s!==void 0?this.region=new s().fromJSON(t):W.warn("YUKA.Trigger: Unsupported trigger region type:",t.type)}return this}registerType(e,t){return this._typesMap.set(e,t),this}}const Ne=new Array;class ha{constructor(){this.entities=new Array,this.spatialIndex=null,this._triggers=new Array,this._indexMap=new Map,this._typesMap=new Map,this._messageDispatcher=new Cr}add(e){return this.entities.push(e),e.manager=this,this}remove(e){const t=this.entities.indexOf(e);return this.entities.splice(t,1),e.manager=null,this}clear(){return this.entities.length=0,this._messageDispatcher.clear(),this}getEntityByName(e){const t=this.entities;for(let n=0,s=t.length;n<s;n++){const i=t[n];if(i.name===e)return i}return null}update(e){const t=this.entities,n=this._triggers;for(let s=t.length-1;s>=0;s--){const i=t[s];this.updateEntity(i,e)}for(let s=n.length-1;s>=0;s--){const i=n[s];this.processTrigger(i)}return this._triggers.length=0,this._messageDispatcher.dispatchDelayedMessages(e),this}updateEntity(e,t){if(e.active===!0){this.updateNeighborhood(e),e._started===!1&&(e.start(),e._started=!0),e.update(t);const n=e.children;for(let r=n.length-1;r>=0;r--){const o=n[r];this.updateEntity(o,t)}if(e instanceof us&&this._triggers.push(e),this.spatialIndex!==null){let r=this._indexMap.get(e)||-1;r=this.spatialIndex.updateEntity(e,r),this._indexMap.set(e,r)}const s=e._renderComponent,i=e._renderComponentCallback;s!==null&&i!==null&&i(e,s)}return this}updateNeighborhood(e){if(e.updateNeighborhood===!0){e.neighbors.length=0,this.spatialIndex!==null?this.spatialIndex.query(e.position,e.neighborhoodRadius,Ne):(Ne.length=0,Ne.push(...this.entities));const t=e.neighborhoodRadius*e.neighborhoodRadius;for(let n=0,s=Ne.length;n<s;n++){const i=Ne[n];e!==i&&i.active===!0&&e.position.squaredDistanceTo(i.position)<=t&&e.neighbors.push(i)}}return this}processTrigger(e){e.updateRegion();const t=this.entities;for(let n=t.length-1;n>=0;n--){const s=t[n];e!==s&&s.active===!0&&s.canActivateTrigger===!0&&e.check(s)}return this}sendMessage(e,t,n,s,i){return this._messageDispatcher.dispatch(e,t,n,s,i),this}toJSON(){const e={type:this.constructor.name,entities:new Array,_messageDispatcher:this._messageDispatcher.toJSON()};function t(n){e.entities.push(n.toJSON());for(let s=0,i=n.children.length;s<i;s++)t(n.children[s])}for(let n=0,s=this.entities.length;n<s;n++)t(this.entities[n]);return e}fromJSON(e){this.clear();const t=e.entities,n=e._messageDispatcher,s=new Map;for(let i=0,r=t.length;i<r;i++){const o=t[i],c=o.type;let l;switch(c){case"GameEntity":l=new An().fromJSON(o);break;case"MovingEntity":l=new qs().fromJSON(o);break;case"Vehicle":l=new Yr().fromJSON(o);break;case"Trigger":l=new us().fromJSON(o);break;default:const h=this._typesMap.get(c);if(h!==void 0)l=new h().fromJSON(o);else{W.warn("YUKA.EntityManager: Unsupported entity type:",c);continue}}s.set(l.uuid,l),l.parent===null&&this.add(l)}for(let i of s.values())i.resolveReferences(s);return this._messageDispatcher.fromJSON(n),this}registerType(e,t){return this._typesMap.set(e,t),this}}const xe=new w,jt=new w,it=new w;class eo{constructor(e=new w(0,0,1),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal=e,this.constant=t,this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}clone(){return new this.constructor().copy(this)}distanceToPoint(e){return this.normal.dot(e)+this.constant}fromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}fromCoplanarPoints(e,t,n){return xe.subVectors(n,t).cross(jt.subVectors(e,t)).normalize(),this.fromNormalAndCoplanarPoint(xe,e),this}intersectPlane(e,t){it.crossVectors(this.normal,e.normal);const n=it.dot(it);return n===0?null:(xe.copy(e.normal).multiplyScalar(this.constant),jt.copy(this.normal).multiplyScalar(e.constant),t.crossVectors(xe.sub(jt),it).divideScalar(n),t)}intersectsPlane(e){const t=this.normal.dot(e.normal);return Math.abs(t)!==1}projectPoint(e,t){return xe.copy(this.normal).multiplyScalar(this.distanceToPoint(e)),t.subVectors(e,xe),t}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}class js{constructor(e=-1,t=-1,n=0){this.from=e,this.to=t,this.cost=n}copy(e){return this.from=e.from,this.to=e.to,this.cost=e.cost,this}clone(){return new this.constructor().copy(this)}toJSON(){return{type:this.constructor.name,from:this.from,to:this.to,cost:this.cost}}fromJSON(e){return this.from=e.from,this.to=e.to,this.cost=e.cost,this}}class Xs{constructor(e=-1){this.index=e}toJSON(){return{type:this.constructor.name,index:this.index}}fromJSON(e){return this.index=e.index,this}}class to{constructor(){this.digraph=!1,this._nodes=new Map,this._edges=new Map}addNode(e){const t=e.index;return this._nodes.set(t,e),this._edges.set(t,new Array),this}addEdge(e){let t;if(t=this._edges.get(e.from),t.push(e),this.digraph===!1){const n=e.clone();n.from=e.to,n.to=e.from,t=this._edges.get(e.to),t.push(n)}return this}getNode(e){return this._nodes.get(e)||null}getEdge(e,t){if(this.hasNode(e)&&this.hasNode(t)){const n=this._edges.get(e);for(let s=0,i=n.length;s<i;s++){const r=n[s];if(r.to===t)return r}}return null}getNodes(e){return e.length=0,e.push(...this._nodes.values()),e}getEdgesOfNode(e,t){const n=this._edges.get(e);return n!==void 0&&(t.length=0,t.push(...n)),t}getNodeCount(){return this._nodes.size}getEdgeCount(){let e=0;for(const t of this._edges.values())e+=t.length;return e}removeNode(e){if(this._nodes.delete(e.index),this.digraph===!1){const t=this._edges.get(e.index);for(const n of t){const s=this._edges.get(n.to);for(let i=s.length-1;i>=0;i--){const r=s[i];if(r.to===e.index){const o=s.indexOf(r);s.splice(o,1);break}}}}else for(const t of this._edges.values())for(let n=t.length-1;n>=0;n--){const s=t[n];if(!this.hasNode(s.to)||!this.hasNode(s.from)){const i=t.indexOf(s);t.splice(i,1)}}return this._edges.delete(e.index),this}removeEdge(e){const t=this._edges.get(e.from);if(t!==void 0){const n=t.indexOf(e);if(t.splice(n,1),this.digraph===!1){const s=this._edges.get(e.to);for(let i=0,r=s.length;i<r;i++){const o=s[i];if(o.to===e.from){const c=s.indexOf(o);s.splice(c,1);break}}}}return this}hasNode(e){return this._nodes.has(e)}hasEdge(e,t){if(this.hasNode(e)&&this.hasNode(t)){const n=this._edges.get(e);for(let s=0,i=n.length;s<i;s++)if(n[s].to===t)return!0;return!1}else return!1}clear(){return this._nodes.clear(),this._edges.clear(),this}toJSON(){const e={type:this.constructor.name,digraph:this.digraph},t=new Array,n=new Array;for(let[s,i]of this._nodes.entries()){const r=new Array;this.getEdgesOfNode(s,r);for(let o=0,c=r.length;o<c;o++)t.push(r[o].toJSON());n.push(i.toJSON())}return e._edges=t,e._nodes=n,e}fromJSON(e){this.digraph=e.digraph;for(let t=0,n=e._nodes.length;t<n;t++)this.addNode(new Xs().fromJSON(e._nodes[t]));for(let t=0,n=e._edges.length;t<n;t++)this.addEdge(new js().fromJSON(e._edges[t]));return this}}class no{static calculate(e,t,n){const s=e.getNode(t),i=e.getNode(n);return s.position.distanceTo(i.position)}}class so{constructor(e=io){this.data=new Array,this.length=0,this.compare=e}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return null;const e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}peek(){return this.data[0]||null}_up(e){const t=this.data,n=this.compare,s=t[e];for(;e>0;){const i=e-1>>1,r=t[i];if(n(s,r)>=0)break;t[e]=r,e=i}t[e]=s}_down(e){const t=this.data,n=this.compare,s=t[e],i=this.length>>1;for(;e<i;){let r=(e<<1)+1,o=r+1,c=t[r];if(o<this.length&&n(t[o],c)<0&&(r=o,c=t[o]),n(c,s)>=0)break;t[e]=c,e=r}t[e]=s}}function io(a,e){return a<e?-1:a>e?1:0}class ro{constructor(e=null,t=-1,n=-1){this.graph=e,this.source=t,this.target=n,this.found=!1,this.heuristic=no,this._cost=new Map,this._shortestPathTree=new Map,this._searchFrontier=new Map}search(){const e=new Array,t=new so(oo);for(t.push({cost:0,index:this.source});t.length>0;){const s=t.pop().index;if(!this._shortestPathTree.has(s)){if(this._searchFrontier.has(s)===!0&&this._shortestPathTree.set(s,this._searchFrontier.get(s)),s===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(s,e);for(let i=0,r=e.length;i<r;i++){const o=e[i],c=(this._cost.get(s)||0)+o.cost,l=this.heuristic.calculate(this.graph,o.to,this.target),h=c+l;(this._searchFrontier.has(o.to)===!1||c<this._cost.get(o.to))&&(this._cost.set(o.to,c),this._searchFrontier.set(o.to,o),t.push({cost:h,index:o.to}))}}}return this.found=!1,this}getPath(){const e=new Array;if(this.found===!1||this.target===-1)return e;let t=this.target;for(e.push(t);t!==this.source;)t=this._shortestPathTree.get(t).from,e.unshift(t);return e}getSearchTree(){return[...this._shortestPathTree.values()]}clear(){return this.found=!1,this._cost.clear(),this._shortestPathTree.clear(),this._searchFrontier.clear(),this}}function oo(a,e){return a.cost<e.cost?-1:a.cost>e.cost?1:0}new Array;const ds=new w,rt=new w;class ao{constructor(e=new w,t=new w){this.from=e,this.to=t}set(e,t){return this.from=e,this.to=t,this}copy(e){return this.from.copy(e.from),this.to.copy(e.to),this}clone(){return new this.constructor().copy(this)}delta(e){return e.subVectors(this.to,this.from)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.from)}closestPointToPoint(e,t,n){const s=this.closestPointToPointParameter(e,t);return this.at(s,n)}closestPointToPointParameter(e,t=!0){ds.subVectors(e,this.from),rt.subVectors(this.to,this.from);const n=rt.dot(rt);let i=rt.dot(ds)/n;return t&&(i=ee.clamp(i,0,1)),i}equals(e){return e.from.equals(this.from)&&e.to.equals(this.to)}}class co{constructor(e=new w){this.vertex=e,this.next=null,this.prev=null,this.twin=null,this.polygon=null}tail(){return this.prev?this.prev.vertex:null}head(){return this.vertex}length(){const e=this.tail(),t=this.head();return e!==null?e.distanceTo(t):-1}squaredLength(){const e=this.tail(),t=this.head();return e!==null?e.squaredDistanceTo(t):-1}linkOpponent(e){return this.twin=e,e.twin=this,this}getDirection(e){return e.subVectors(this.vertex,this.prev.vertex).normalize()}}class fs{constructor(){this.centroid=new w,this.edge=null,this.plane=new eo}fromContour(e){const t=new Array;if(e.length<3)return W.error("YUKA.Polygon: Unable to create polygon from contour. It needs at least three points."),this;for(let n=0,s=e.length;n<s;n++){const i=new co(e[n]);t.push(i)}for(let n=0,s=t.length;n<s;n++){let i,r,o;n===0?(i=t[n],r=t[s-1],o=t[n+1]):n===s-1?(i=t[n],r=t[n-1],o=t[0]):(i=t[n],r=t[n-1],o=t[n+1]),i.prev=r,i.next=o,i.polygon=this}return this.edge=t[0],this.plane.fromCoplanarPoints(e[0],e[1],e[2]),this}computeCentroid(){const e=this.centroid;let t=this.edge,n=0;e.set(0,0,0);do e.add(t.vertex),n++,t=t.next;while(t!==this.edge);return e.divideScalar(n),this}contains(e,t=.001){const n=this.plane;let s=this.edge;do{const r=s.tail(),o=s.head();if(Xt(r,o,e)===!1)return!1;s=s.next}while(s!==this.edge);const i=n.distanceToPoint(e);return!(Math.abs(i)>t)}convex(e=!0){let t=this.edge;do{const n=t.tail(),s=t.head(),i=t.next.head();if(e){if(Xt(n,s,i)===!1)return!1}else if(Xt(i,s,n)===!1)return!1;t=t.next}while(t!==this.edge);return!0}coplanar(e=.001){const t=this.plane;let n=this.edge;do{const s=t.distanceToPoint(n.vertex);if(Math.abs(s)>e)return!1;n=n.next}while(n!==this.edge);return!0}distanceToPoint(e){return this.plane.distanceToPoint(e)}getContour(e){let t=this.edge;e.length=0;do e.push(t.vertex),t=t.next;while(t!==this.edge);return e}}function Xt(a,e,t){return ee.area(a,e,t)>=0}class ho extends js{constructor(e=-1,t=-1,n=0){super(e,t,n)}}class lo extends Xs{constructor(e=-1,t=new w,n={}){super(e),this.position=t,this.userData=n}}class uo{constructor(){this.portalEdges=new Array}push(e,t){return this.portalEdges.push({left:e,right:t}),this}generate(){const e=this.portalEdges,t=new Array;let n,s,i,r=0,o=0,c=0;n=e[0].left,s=e[0].left,i=e[0].right,t.push(n);for(let l=1,h=e.length;l<h;l++){const u=e[l].left,d=e[l].right;if(ee.area(n,i,d)<=0)if(n===i||ee.area(n,s,d)>0)i=d,c=l;else{t.push(s),n=s,r=o,s=n,i=n,o=r,c=r,l=r;continue}if(ee.area(n,s,u)>=0)if(n===s||ee.area(n,i,u)<0)s=u,o=l;else{t.push(i),n=i,r=c,s=n,i=n,o=r,c=r,l=r;continue}}return(t.length===0||t[t.length-1]!==e[e.length-1].left)&&t.push(e[e.length-1].left),t}}const $t=new w,Yt=new w,Qt=new w,Oe=new w,Le=new ao,Zt=new Array,en={edge:null,closestPoint:new w};class fo{constructor(){this.graph=new to,this.graph.digraph=!0,this.regions=new Array,this.spatialIndex=null,this.epsilonCoplanarTest=.001,this.epsilonContainsTest=1,this.mergeConvexRegions=!0,this._borderEdges=new Array}fromPolygons(e){this.clear();const t=new Array,n=new Array;for(let s=0,i=e.length;s<i;s++){const r=e[s];let o=r.edge;do t.push(o),o=o.next;while(o!==r.edge);this.regions.push(r)}for(let s=0,i=t.length;s<i;s++){let r=t[s];if(r.twin===null)for(let o=s+1,c=t.length;o<c;o++){let l=t[o];if(r.tail().equals(l.head())&&r.head().equals(l.tail())){r.linkOpponent(l);const h=r.squaredLength();n.push({cost:h,edge:r});break}}}return n.sort(po),this._buildRegions(n),this._buildGraph(),this}clear(){return this.graph.clear(),this.regions.length=0,this.spatialIndex=null,this}getClosestRegion(e){const t=this.regions;let n=null,s=1/0;for(let i=0,r=t.length;i<r;i++){const o=t[i],c=e.squaredDistanceTo(o.centroid);c<s&&(s=c,n=o)}return n}getRandomRegion(){const e=this.regions;let t=Math.floor(Math.random()*e.length);return t===e.length&&(t=e.length-1),e[t]}getRegionForPoint(e,t=.001){let n;if(this.spatialIndex!==null){const s=this.spatialIndex.getIndexForPosition(e);n=this.spatialIndex.cells[s].entries}else n=this.regions;for(let s=0,i=n.length;s<i;s++){const r=n[s];if(r.contains(e,t)===!0)return r}return null}getNodeIndex(e){return this.regions.indexOf(e)}findPath(e,t){const n=this.graph,s=new Array;let i=this.getRegionForPoint(e,this.epsilonContainsTest),r=this.getRegionForPoint(t,this.epsilonContainsTest);if((i===null||r===null)&&(i===null&&(i=this.getClosestRegion(e)),r===null&&(r=this.getClosestRegion(t))),i===r)return s.push(new w().copy(e)),s.push(new w().copy(t)),s;{const o=this.getNodeIndex(i),c=this.getNodeIndex(r),l=new ro(n,o,c);if(l.search(),l.found===!0){const h=l.getPath(),u=new uo;u.push(e,e);const d={left:null,right:null};for(let f=0,p=h.length-1;f<p;f++){const y=this.regions[h[f]],g=this.regions[h[f+1]];this._getPortalEdge(y,g,d),u.push(d.left,d.right)}u.push(t,t),s.push(...u.generate())}return s}}clampMovement(e,t,n,s){let i=this.getRegionForPoint(n,this.epsilonContainsTest);if(i===null){if(e===null)throw new Error("YUKA.NavMesh.clampMovement(): No current region available.");this._getClosestBorderEdge(t,en);const r=en.edge,o=en.closestPoint;r.getDirection(Yt);const c=Qt.subVectors(n,t).length();let l=0;c!==0&&(Qt.divideScalar(c),l=Yt.dot(Qt)),Oe.copy(o).add(Yt.multiplyScalar(l*c)),Le.set(r.prev.vertex,r.vertex);const h=Le.closestPointToPointParameter(Oe,!1);if(h>=0&&h<=1)s.copy(Oe);else{if(i=this.getRegionForPoint(Oe,this.epsilonContainsTest),i!==null)return s.copy(Oe),i;s.copy(t)}return e}else return i}updateSpatialIndex(){if(this.spatialIndex!==null){this.spatialIndex.makeEmpty();const e=this.regions;for(let t=0,n=e.length;t<n;t++){const s=e[t];this.spatialIndex.addPolygon(s)}}return this}_buildRegions(e){const t=this.regions,n={leftPrev:null,leftNext:null,rightPrev:null,rightNext:null};if(this.mergeConvexRegions===!0)for(let s=0,i=e.length;s<i;s++){const r=e[s];let o=r.edge;n.prev=o.prev,n.next=o.next,n.prevTwin=o.twin.prev,n.nextTwin=o.twin.next,o.prev.next=o.twin.next,o.next.prev=o.twin.prev,o.twin.prev.next=o.next,o.twin.next.prev=o.prev;const c=o.polygon;if(c.edge=o.prev,c.convex()===!0&&c.coplanar(this.epsilonCoplanarTest)===!0){let l=c.edge;do l.polygon=c,l=l.next;while(l!==c.edge);const h=t.indexOf(r.edge.twin.polygon);t.splice(h,1)}else n.prev.next=o,n.next.prev=o,n.prevTwin.next=o.twin,n.nextTwin.prev=o.twin,c.edge=o}for(let s=0,i=t.length;s<i;s++){const r=t[s];r.computeCentroid();let o=r.edge;do o.twin===null&&this._borderEdges.push(o),o=o.next;while(o!==r.edge)}}_buildGraph(){const e=this.graph,t=this.regions,n=new Array;for(let s=0,i=t.length;s<i;s++){const r=t[s],o=new Array;n.push(o);let c=r.edge;do{if(c.twin!==null){const l=this.getNodeIndex(c.twin.polygon);if(o.push(l),e.hasNode(this.getNodeIndex(c.polygon))===!1){const h=new lo(this.getNodeIndex(c.polygon),c.polygon.centroid);e.addNode(h)}}c=c.next}while(c!==r.edge)}for(let s=0,i=n.length;s<i;s++){const r=n[s],o=s;for(let c=0,l=r.length;c<l;c++){const h=r[c];if(o!==h&&e.hasEdge(o,h)===!1){const u=e.getNode(o),d=e.getNode(h),f=u.position.distanceTo(d.position);e.addEdge(new ho(o,h,f))}}}return this}_getClosestBorderEdge(e,t){let n,s=1/0;if(this.spatialIndex!==null){Zt.length=0;const i=this.spatialIndex.getIndexForPosition(e),r=this.spatialIndex.cells[i].entries;for(let o=0,c=r.length;o<c;o++){const l=r[o];let h=l.edge;do h.twin===null&&Zt.push(h),h=h.next;while(h!==l.edge)}n=Zt}else n=this._borderEdges;for(let i=0,r=n.length;i<r;i++){const o=n[i];Le.set(o.prev.vertex,o.vertex);const c=Le.closestPointToPointParameter(e);Le.at(c,$t);const l=$t.squaredDistanceTo(e);l<s&&(s=l,t.edge=o,t.closestPoint.copy($t))}return this}_getPortalEdge(e,t,n){let s=e.edge;do{if(s.twin!==null&&s.twin.polygon===t)return n.left=s.prev.vertex,n.right=s.vertex,n;s=s.next}while(s!==e.edge);return n.left=null,n.right=null,n}}function po(a,e){return a.cost<e.cost?1:a.cost>e.cost?-1:0}class la{load(e,t){return new Promise((n,s)=>{fetch(e).then(i=>{if(i.status>=200&&i.status<300)return i.arrayBuffer();{const r=new Error(i.statusText||i.status);return r.response=i,Promise.reject(r)}}).then(i=>this.parse(i,e,t)).then(i=>{n(i)}).catch(i=>{W.error("YUKA.NavMeshLoader: Unable to load navigation mesh.",i),s(i)})})}parse(e,t,n){const s=new go,i=new TextDecoder;let r;i.decode(new Uint8Array(e,0,4))===Ao?(s.parseBinary(e),r=s.extensions.get("BINARY").content):r=i.decode(new Uint8Array(e));const c=JSON.parse(r);if(c.asset===void 0||c.asset.version[0]<2)throw new Error("YUKA.NavMeshLoader: Unsupported asset version.");{const l=mo(t);return s.parse(c,l,n)}}}class go{constructor(){this.json=null,this.path=null,this.cache=new Map,this.extensions=new Map}parse(e,t,n){return this.json=e,this.path=t,this.getDependency("mesh",0).then(s=>{const i=this.parseGeometry(s),r=new fo;return n&&(n.epsilonCoplanarTest!==void 0&&(r.epsilonCoplanarTest=n.epsilonCoplanarTest),n.mergeConvexRegions!==void 0&&(r.mergeConvexRegions=n.mergeConvexRegions)),r.fromPolygons(i)})}parseGeometry(e){const t=e.index,n=e.position,s=new Array,i=new Array;for(let r=0,o=n.length;r<o;r+=3){const c=new w;c.x=n[r+0],c.y=n[r+1],c.z=n[r+2],s.push(c)}if(t)for(let r=0,o=t.length;r<o;r+=3){const c=t[r+0],l=t[r+1],h=t[r+2],u=[s[c],s[l],s[h]],d=new fs().fromContour(u);i.push(d)}else for(let r=0,o=s.length;r<o;r+=3){const c=[s[r+0],s[r+1],s[r+2]],l=new fs().fromContour(c);i.push(l)}return i}getDependencies(e){const t=this.cache;let n=t.get(e);if(!n){const s=this.json[e+(e==="mesh"?"es":"s")]||new Array;n=Promise.all(s.map((i,r)=>this.getDependency(e,r))),t.set(e,n)}return n}getDependency(e,t){const n=this.cache,s=e+":"+t;let i=n.get(s);if(i===void 0){switch(e){case"accessor":i=this.loadAccessor(t);break;case"buffer":i=this.loadBuffer(t);break;case"bufferView":i=this.loadBufferView(t);break;case"mesh":i=this.loadMesh(t);break;default:throw new Error("Unknown type: "+e)}n.set(s,i)}return i}loadBuffer(e){const n=this.json.buffers[e];return n.uri===void 0&&e===0?Promise.resolve(this.extensions.get("BINARY").body):new Promise((s,i)=>{const r=yo(n.uri,this.path);fetch(r).then(o=>o.arrayBuffer()).then(o=>{s(o)}).catch(o=>{W.error("YUKA.NavMeshLoader: Unable to load buffer.",o),i(o)})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(s=>{const i=n.byteLength||0,r=n.byteOffset||0;return s.slice(r,r+i)})}loadAccessor(e){const n=this.json.accessors[e];return this.getDependency("bufferView",n.bufferView).then(s=>{const i=xo[n.type],r=wo[n.componentType],o=n.byteOffset||0;return new r(s,o,n.count*i)})}loadMesh(e){const n=this.json.meshes[e];return this.getDependencies("accessor").then(s=>{const i=n.primitives[0];if(i.mode!==void 0&&i.mode!==4)throw new Error("YUKA.NavMeshLoader: Invalid geometry format. Please ensure to represent your geometry as triangles.");return{index:s[i.indices],position:s[i.attributes.POSITION],normal:s[i.attributes.NORMAL]}})}parseBinary(e){const t=new DataView(e,tn);let n=0;const s=new TextDecoder;let i=null,r=null;for(;n<t.byteLength;){const o=t.getUint32(n,!0);n+=4;const c=t.getUint32(n,!0);if(n+=4,c===ps.JSON){const l=new Uint8Array(e,tn+n,o);i=s.decode(l)}else if(c===ps.BIN){const l=tn+n;r=e.slice(l,l+o)}n+=o}this.extensions.set("BINARY",{content:i,body:r})}}function mo(a=""){const e=a.lastIndexOf("/");return e===-1?"./":a.substr(0,e+1)}function yo(a,e){return typeof a!="string"||a===""?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:e+a}const xo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},wo={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ao="glTF",tn=12,ps={JSON:1313821514,BIN:5130562};new Array;class To{constructor({sizes:e,scene:t,canvas:n},s={isOrthographic:!1}){this.sizes=e,this.scene=t,this.wWidth=0,this.wHeight=0,this.canvas=n,this.options=Object.assign({isOrthographic:!1},s),this.setInstance(),document.addEventListener("keydown",i=>{let r=new w().copy(this.instance.position);switch(i.keyCode){case 79:this.setCamera(),this.instance.position.copy(r),this.instance.updateProjectionMatrix();break;case 80:this.setCamera(!1),this.instance.position.copy(r),this.instance.updateProjectionMatrix();break}})}getCameraViewSize(){if(this.instance instanceof an){const e=this.instance.fov*Math.PI/180,t=2*Math.tan(e/2)*Math.abs(this.instance.position.z),n=t*this.instance.aspect;this.wWidth=n,this.wHeight=t}else this.wWidth=this.instance.top-this.instance.bottom,this.wHeight=this.instance.right-this.instance.left;return[this.wWidth,this.wHeight]}setInstance(){this.instance=null,this.setCamera(this.options.isOrthographic),this.instance.position.set(10,10,10),this.scene.add(this.instance)}setCamera(e=!0){let t=this.sizes.width/this.sizes.height;if(e){let n=120;this.instance=new Fs(-n*t,n*t,n,-n,1,1e4)}else this.instance=new an(45,t,1,1e4);this.setControls(),this.getCameraViewSize()}setControls(){this.controls=new Ui(this.instance,this.canvas),this.controls.enableDamping=!0,this.controls.update()}resize(){let e=this.sizes.width/this.sizes.height;if(this.options.isOrthographic){let t=120;this.instance.left=-t*e,this.instance.right=t*e,this.instance.top=t,this.instance.bottom=-t}else this.instance.aspect=e;this.instance.updateProjectionMatrix()}update(){this.controls.update()}destroy(){this.controls.dispose()}}class So{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let s=0;s<this._n&&s<32;s++){const i=t[s],r=e+i,o=Math.abs(e)<Math.abs(i)?e-(r-i):i-(r-e);o&&(t[n++]=o),e=r}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t=this._n,n,s,i,r=0;if(t>0){for(r=e[--t];t>0&&(n=r,s=e[--t],r=n+s,i=s-(r-n),!i););t>0&&(i<0&&e[t-1]<0||i>0&&e[t-1]>0)&&(s=i*2,n=r+s,s==n-r&&(r=n))}return r}}function*Mo(a){for(const e of a)yield*e}function $s(a){return Array.from(Mo(a))}var z=1e-6,_o=1e-12,L=Math.PI,K=L/2,gs=L/4,Z=L*2,X=180/L,G=L/180,k=Math.abs,Ys=Math.atan,ke=Math.atan2,F=Math.cos,Eo=Math.exp,bo=Math.log,B=Math.sin,vo=Math.sign||function(a){return a>0?1:a<0?-1:0},_t=Math.sqrt,Ro=Math.tan;function No(a){return a>1?0:a<-1?L:Math.acos(a)}function Fe(a){return a>1?K:a<-1?-K:Math.asin(a)}function Pe(){}function gt(a,e){a&&ys.hasOwnProperty(a.type)&&ys[a.type](a,e)}var ms={Feature:function(a,e){gt(a.geometry,e)},FeatureCollection:function(a,e){for(var t=a.features,n=-1,s=t.length;++n<s;)gt(t[n].geometry,e)}},ys={Sphere:function(a,e){e.sphere()},Point:function(a,e){a=a.coordinates,e.point(a[0],a[1],a[2])},MultiPoint:function(a,e){for(var t=a.coordinates,n=-1,s=t.length;++n<s;)a=t[n],e.point(a[0],a[1],a[2])},LineString:function(a,e){un(a.coordinates,e,0)},MultiLineString:function(a,e){for(var t=a.coordinates,n=-1,s=t.length;++n<s;)un(t[n],e,0)},Polygon:function(a,e){xs(a.coordinates,e)},MultiPolygon:function(a,e){for(var t=a.coordinates,n=-1,s=t.length;++n<s;)xs(t[n],e)},GeometryCollection:function(a,e){for(var t=a.geometries,n=-1,s=t.length;++n<s;)gt(t[n],e)}};function un(a,e,t){var n=-1,s=a.length-t,i;for(e.lineStart();++n<s;)i=a[n],e.point(i[0],i[1],i[2]);e.lineEnd()}function xs(a,e){var t=-1,n=a.length;for(e.polygonStart();++t<n;)un(a[t],e,1);e.polygonEnd()}function Oo(a,e){a&&ms.hasOwnProperty(a.type)?ms[a.type](a,e):gt(a,e)}function dn(a){return[ke(a[1],a[0]),Fe(a[2])]}function Se(a){var e=a[0],t=a[1],n=F(t);return[n*F(e),n*B(e),B(t)]}function ot(a,e){return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]}function mt(a,e){return[a[1]*e[2]-a[2]*e[1],a[2]*e[0]-a[0]*e[2],a[0]*e[1]-a[1]*e[0]]}function nn(a,e){a[0]+=e[0],a[1]+=e[1],a[2]+=e[2]}function at(a,e){return[a[0]*e,a[1]*e,a[2]*e]}function fn(a){var e=_t(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]/=e,a[1]/=e,a[2]/=e}function pn(a,e){function t(n,s){return n=a(n,s),e(n[0],n[1])}return a.invert&&e.invert&&(t.invert=function(n,s){return n=e.invert(n,s),n&&a.invert(n[0],n[1])}),t}function gn(a,e){return k(a)>L&&(a-=Math.round(a/Z)*Z),[a,e]}gn.invert=gn;function Qs(a,e,t){return(a%=Z)?e||t?pn(As(a),Ts(e,t)):As(a):e||t?Ts(e,t):gn}function ws(a){return function(e,t){return e+=a,k(e)>L&&(e-=Math.round(e/Z)*Z),[e,t]}}function As(a){var e=ws(a);return e.invert=ws(-a),e}function Ts(a,e){var t=F(a),n=B(a),s=F(e),i=B(e);function r(o,c){var l=F(c),h=F(o)*l,u=B(o)*l,d=B(c),f=d*t+h*n;return[ke(u*s-f*i,h*t-d*n),Fe(f*s+u*i)]}return r.invert=function(o,c){var l=F(c),h=F(o)*l,u=B(o)*l,d=B(c),f=d*s-u*i;return[ke(u*s+d*i,h*t+f*n),Fe(f*t-h*n)]},r}function Lo(a){a=Qs(a[0]*G,a[1]*G,a.length>2?a[2]*G:0);function e(t){return t=a(t[0]*G,t[1]*G),t[0]*=X,t[1]*=X,t}return e.invert=function(t){return t=a.invert(t[0]*G,t[1]*G),t[0]*=X,t[1]*=X,t},e}function Io(a,e,t,n,s,i){if(t){var r=F(e),o=B(e),c=n*t;s==null?(s=e+n*Z,i=e-c/2):(s=Ss(r,s),i=Ss(r,i),(n>0?s<i:s>i)&&(s+=n*Z));for(var l,h=s;n>0?h>i:h<i;h-=c)l=dn([r,-o*F(h),-o*B(h)]),a.point(l[0],l[1])}}function Ss(a,e){e=Se(e),e[0]-=a,fn(e);var t=No(-e[1]);return((-e[2]<0?-t:t)+Z-z)%Z}function Zs(){var a=[],e;return{point:function(t,n,s){e.push([t,n,s])},lineStart:function(){a.push(e=[])},lineEnd:Pe,rejoin:function(){a.length>1&&a.push(a.pop().concat(a.shift()))},result:function(){var t=a;return a=[],e=null,t}}}function lt(a,e){return k(a[0]-e[0])<z&&k(a[1]-e[1])<z}function ct(a,e,t,n){this.x=a,this.z=e,this.o=t,this.e=n,this.v=!1,this.n=this.p=null}function ei(a,e,t,n,s){var i=[],r=[],o,c;if(a.forEach(function(p){if(!((y=p.length-1)<=0)){var y,g=p[0],m=p[y],x;if(lt(g,m)){if(!g[2]&&!m[2]){for(s.lineStart(),o=0;o<y;++o)s.point((g=p[o])[0],g[1]);s.lineEnd();return}m[0]+=2*z}i.push(x=new ct(g,p,null,!0)),r.push(x.o=new ct(g,null,x,!1)),i.push(x=new ct(m,p,null,!1)),r.push(x.o=new ct(m,null,x,!0))}}),!!i.length){for(r.sort(e),Ms(i),Ms(r),o=0,c=r.length;o<c;++o)r[o].e=t=!t;for(var l=i[0],h,u;;){for(var d=l,f=!0;d.v;)if((d=d.n)===l)return;h=d.z,s.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(o=0,c=h.length;o<c;++o)s.point((u=h[o])[0],u[1]);else n(d.x,d.n.x,1,s);d=d.n}else{if(f)for(h=d.p.z,o=h.length-1;o>=0;--o)s.point((u=h[o])[0],u[1]);else n(d.x,d.p.x,-1,s);d=d.p}d=d.o,h=d.z,f=!f}while(!d.v);s.lineEnd()}}}function Ms(a){if(e=a.length){for(var e,t=0,n=a[0],s;++t<e;)n.n=s=a[t],s.p=n,n=s;n.n=s=a[0],s.p=n}}function sn(a){return k(a[0])<=L?a[0]:vo(a[0])*((k(a[0])+L)%Z-L)}function Po(a,e){var t=sn(e),n=e[1],s=B(n),i=[B(t),-F(t),0],r=0,o=0,c=new So;s===1?n=K+z:s===-1&&(n=-K-z);for(var l=0,h=a.length;l<h;++l)if(d=(u=a[l]).length)for(var u,d,f=u[d-1],p=sn(f),y=f[1]/2+gs,g=B(y),m=F(y),x=0;x<d;++x,p=A,g=E,m=b,f=S){var S=u[x],A=sn(S),_=S[1]/2+gs,E=B(_),b=F(_),R=A-p,M=R>=0?1:-1,I=M*R,v=I>L,U=g*E;if(c.add(ke(U*M*B(I),m*b+U*F(I))),r+=v?R+M*Z:R,v^p>=t^A>=t){var C=mt(Se(f),Se(S));fn(C);var P=mt(i,C);fn(P);var T=(v^R>=0?-1:1)*Fe(P[2]);(n>T||n===T&&(C[0]||C[1]))&&(o+=v^R>=0?1:-1)}}return(r<-z||r<z&&c<-_o)^o&1}function ti(a,e,t,n){return function(s){var i=e(s),r=Zs(),o=e(r),c=!1,l,h,u,d={point:f,lineStart:y,lineEnd:g,polygonStart:function(){d.point=m,d.lineStart=x,d.lineEnd=S,h=[],l=[]},polygonEnd:function(){d.point=f,d.lineStart=y,d.lineEnd=g,h=$s(h);var A=Po(l,n);h.length?(c||(s.polygonStart(),c=!0),ei(h,zo,A,t,s)):A&&(c||(s.polygonStart(),c=!0),s.lineStart(),t(null,null,1,s),s.lineEnd()),c&&(s.polygonEnd(),c=!1),h=l=null},sphere:function(){s.polygonStart(),s.lineStart(),t(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function f(A,_){a(A,_)&&s.point(A,_)}function p(A,_){i.point(A,_)}function y(){d.point=p,i.lineStart()}function g(){d.point=f,i.lineEnd()}function m(A,_){u.push([A,_]),o.point(A,_)}function x(){o.lineStart(),u=[]}function S(){m(u[0][0],u[0][1]),o.lineEnd();var A=o.clean(),_=r.result(),E,b=_.length,R,M,I;if(u.pop(),l.push(u),u=null,!!b){if(A&1){if(M=_[0],(R=M.length-1)>0){for(c||(s.polygonStart(),c=!0),s.lineStart(),E=0;E<R;++E)s.point((I=M[E])[0],I[1]);s.lineEnd()}return}b>1&&A&2&&_.push(_.pop().concat(_.shift())),h.push(_.filter(Co))}}return d}}function Co(a){return a.length>1}function zo(a,e){return((a=a.x)[0]<0?a[1]-K-z:K-a[1])-((e=e.x)[0]<0?e[1]-K-z:K-e[1])}const _s=ti(function(){return!0},Do,Fo,[-L,-K]);function Do(a){var e=NaN,t=NaN,n=NaN,s;return{lineStart:function(){a.lineStart(),s=1},point:function(i,r){var o=i>0?L:-L,c=k(i-e);k(c-L)<z?(a.point(e,t=(t+r)/2>0?K:-K),a.point(n,t),a.lineEnd(),a.lineStart(),a.point(o,t),a.point(i,t),s=0):n!==o&&c>=L&&(k(e-n)<z&&(e-=n*z),k(i-o)<z&&(i-=o*z),t=ko(e,t,i,r),a.point(n,t),a.lineEnd(),a.lineStart(),a.point(o,t),s=0),a.point(e=i,t=r),n=o},lineEnd:function(){a.lineEnd(),e=t=NaN},clean:function(){return 2-s}}}function ko(a,e,t,n){var s,i,r=B(a-t);return k(r)>z?Ys((B(e)*(i=F(n))*B(t)-B(n)*(s=F(e))*B(a))/(s*i*r)):(e+n)/2}function Fo(a,e,t,n){var s;if(a==null)s=t*K,n.point(-L,s),n.point(0,s),n.point(L,s),n.point(L,0),n.point(L,-s),n.point(0,-s),n.point(-L,-s),n.point(-L,0),n.point(-L,s);else if(k(a[0]-e[0])>z){var i=a[0]<e[0]?L:-L;s=t*i/2,n.point(-i,s),n.point(0,s),n.point(i,s)}else n.point(e[0],e[1])}function Bo(a){var e=F(a),t=6*G,n=e>0,s=k(e)>z;function i(h,u,d,f){Io(f,a,t,d,h,u)}function r(h,u){return F(h)*F(u)>e}function o(h){var u,d,f,p,y;return{lineStart:function(){p=f=!1,y=1},point:function(g,m){var x=[g,m],S,A=r(g,m),_=n?A?0:l(g,m):A?l(g+(g<0?L:-L),m):0;if(!u&&(p=f=A)&&h.lineStart(),A!==f&&(S=c(u,x),(!S||lt(u,S)||lt(x,S))&&(x[2]=1)),A!==f)y=0,A?(h.lineStart(),S=c(x,u),h.point(S[0],S[1])):(S=c(u,x),h.point(S[0],S[1],2),h.lineEnd()),u=S;else if(s&&u&&n^A){var E;!(_&d)&&(E=c(x,u,!0))&&(y=0,n?(h.lineStart(),h.point(E[0][0],E[0][1]),h.point(E[1][0],E[1][1]),h.lineEnd()):(h.point(E[1][0],E[1][1]),h.lineEnd(),h.lineStart(),h.point(E[0][0],E[0][1],3)))}A&&(!u||!lt(u,x))&&h.point(x[0],x[1]),u=x,f=A,d=_},lineEnd:function(){f&&h.lineEnd(),u=null},clean:function(){return y|(p&&f)<<1}}}function c(h,u,d){var f=Se(h),p=Se(u),y=[1,0,0],g=mt(f,p),m=ot(g,g),x=g[0],S=m-x*x;if(!S)return!d&&h;var A=e*m/S,_=-e*x/S,E=mt(y,g),b=at(y,A),R=at(g,_);nn(b,R);var M=E,I=ot(b,M),v=ot(M,M),U=I*I-v*(ot(b,b)-1);if(!(U<0)){var C=_t(U),P=at(M,(-I-C)/v);if(nn(P,b),P=dn(P),!d)return P;var T=h[0],N=u[0],D=h[1],H=u[1],J;N<T&&(J=T,T=N,N=J);var te=N-T,q=k(te-L)<z,ue=q||te<z;if(!q&&H<D&&(J=D,D=H,H=J),ue?q?D+H>0^P[1]<(k(P[0]-T)<z?D:H):D<=P[1]&&P[1]<=H:te>L^(T<=P[0]&&P[0]<=N)){var se=at(M,(-I+C)/v);return nn(se,b),[P,dn(se)]}}}function l(h,u){var d=n?a:L-a,f=0;return h<-d?f|=1:h>d&&(f|=2),u<-d?f|=4:u>d&&(f|=8),f}return ti(r,o,i,n?[0,-a]:[-L,a-L])}function Go(a,e,t,n,s,i){var r=a[0],o=a[1],c=e[0],l=e[1],h=0,u=1,d=c-r,f=l-o,p;if(p=t-r,!(!d&&p>0)){if(p/=d,d<0){if(p<h)return;p<u&&(u=p)}else if(d>0){if(p>u)return;p>h&&(h=p)}if(p=s-r,!(!d&&p<0)){if(p/=d,d<0){if(p>u)return;p>h&&(h=p)}else if(d>0){if(p<h)return;p<u&&(u=p)}if(p=n-o,!(!f&&p>0)){if(p/=f,f<0){if(p<h)return;p<u&&(u=p)}else if(f>0){if(p>u)return;p>h&&(h=p)}if(p=i-o,!(!f&&p<0)){if(p/=f,f<0){if(p>u)return;p>h&&(h=p)}else if(f>0){if(p<h)return;p<u&&(u=p)}return h>0&&(a[0]=r+h*d,a[1]=o+h*f),u<1&&(e[0]=r+u*d,e[1]=o+u*f),!0}}}}}var Ce=1e9,ht=-Ce;function Uo(a,e,t,n){function s(l,h){return a<=l&&l<=t&&e<=h&&h<=n}function i(l,h,u,d){var f=0,p=0;if(l==null||(f=r(l,u))!==(p=r(h,u))||c(l,h)<0^u>0)do d.point(f===0||f===3?a:t,f>1?n:e);while((f=(f+u+4)%4)!==p);else d.point(h[0],h[1])}function r(l,h){return k(l[0]-a)<z?h>0?0:3:k(l[0]-t)<z?h>0?2:1:k(l[1]-e)<z?h>0?1:0:h>0?3:2}function o(l,h){return c(l.x,h.x)}function c(l,h){var u=r(l,1),d=r(h,1);return u!==d?u-d:u===0?h[1]-l[1]:u===1?l[0]-h[0]:u===2?l[1]-h[1]:h[0]-l[0]}return function(l){var h=l,u=Zs(),d,f,p,y,g,m,x,S,A,_,E,b={point:R,lineStart:U,lineEnd:C,polygonStart:I,polygonEnd:v};function R(T,N){s(T,N)&&h.point(T,N)}function M(){for(var T=0,N=0,D=f.length;N<D;++N)for(var H=f[N],J=1,te=H.length,q=H[0],ue,se,Ge=q[0],pe=q[1];J<te;++J)ue=Ge,se=pe,q=H[J],Ge=q[0],pe=q[1],se<=n?pe>n&&(Ge-ue)*(n-se)>(pe-se)*(a-ue)&&++T:pe<=n&&(Ge-ue)*(n-se)<(pe-se)*(a-ue)&&--T;return T}function I(){h=u,d=[],f=[],E=!0}function v(){var T=M(),N=E&&T,D=(d=$s(d)).length;(N||D)&&(l.polygonStart(),N&&(l.lineStart(),i(null,null,1,l),l.lineEnd()),D&&ei(d,o,T,i,l),l.polygonEnd()),h=l,d=f=p=null}function U(){b.point=P,f&&f.push(p=[]),_=!0,A=!1,x=S=NaN}function C(){d&&(P(y,g),m&&A&&u.rejoin(),d.push(u.result())),b.point=R,A&&h.lineEnd()}function P(T,N){var D=s(T,N);if(f&&p.push([T,N]),_)y=T,g=N,m=D,_=!1,D&&(h.lineStart(),h.point(T,N));else if(D&&A)h.point(T,N);else{var H=[x=Math.max(ht,Math.min(Ce,x)),S=Math.max(ht,Math.min(Ce,S))],J=[T=Math.max(ht,Math.min(Ce,T)),N=Math.max(ht,Math.min(Ce,N))];Go(H,J,a,e,t,n)?(A||(h.lineStart(),h.point(H[0],H[1])),h.point(J[0],J[1]),D||h.lineEnd(),E=!1):D&&(h.lineStart(),h.point(T,N),E=!1)}x=T,S=N,A=D}return b}}const Es=a=>a;var Me=1/0,yt=Me,Be=-Me,xt=Be,Ho={point:Jo,lineStart:Pe,lineEnd:Pe,polygonStart:Pe,polygonEnd:Pe,result:function(){var a=[[Me,yt],[Be,xt]];return Be=xt=-(yt=Me=1/0),a}};function Jo(a,e){a<Me&&(Me=a),a>Be&&(Be=a),e<yt&&(yt=e),e>xt&&(xt=e)}const bs=Ho;function Sn(a){return function(e){var t=new mn;for(var n in a)t[n]=a[n];return t.stream=e,t}}function mn(){}mn.prototype={constructor:mn,point:function(a,e){this.stream.point(a,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Mn(a,e,t){var n=a.clipExtent&&a.clipExtent();return a.scale(150).translate([0,0]),n!=null&&a.clipExtent(null),Oo(t,a.stream(bs)),e(bs.result()),n!=null&&a.clipExtent(n),a}function ni(a,e,t){return Mn(a,function(n){var s=e[1][0]-e[0][0],i=e[1][1]-e[0][1],r=Math.min(s/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+e[0][0]+(s-r*(n[1][0]+n[0][0]))/2,c=+e[0][1]+(i-r*(n[1][1]+n[0][1]))/2;a.scale(150*r).translate([o,c])},t)}function Vo(a,e,t){return ni(a,[[0,0],e],t)}function qo(a,e,t){return Mn(a,function(n){var s=+e,i=s/(n[1][0]-n[0][0]),r=(s-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];a.scale(150*i).translate([r,o])},t)}function Ko(a,e,t){return Mn(a,function(n){var s=+e,i=s/(n[1][1]-n[0][1]),r=-i*n[0][0],o=(s-i*(n[1][1]+n[0][1]))/2;a.scale(150*i).translate([r,o])},t)}var vs=16,Wo=F(30*G);function Rs(a,e){return+e?Xo(a,e):jo(a)}function jo(a){return Sn({point:function(e,t){e=a(e,t),this.stream.point(e[0],e[1])}})}function Xo(a,e){function t(n,s,i,r,o,c,l,h,u,d,f,p,y,g){var m=l-n,x=h-s,S=m*m+x*x;if(S>4*e&&y--){var A=r+d,_=o+f,E=c+p,b=_t(A*A+_*_+E*E),R=Fe(E/=b),M=k(k(E)-1)<z||k(i-u)<z?(i+u)/2:ke(_,A),I=a(M,R),v=I[0],U=I[1],C=v-n,P=U-s,T=x*C-m*P;(T*T/S>e||k((m*C+x*P)/S-.5)>.3||r*d+o*f+c*p<Wo)&&(t(n,s,i,r,o,c,v,U,M,A/=b,_/=b,E,y,g),g.point(v,U),t(v,U,M,A,_,E,l,h,u,d,f,p,y,g))}}return function(n){var s,i,r,o,c,l,h,u,d,f,p,y,g={point:m,lineStart:x,lineEnd:A,polygonStart:function(){n.polygonStart(),g.lineStart=_},polygonEnd:function(){n.polygonEnd(),g.lineStart=x}};function m(R,M){R=a(R,M),n.point(R[0],R[1])}function x(){u=NaN,g.point=S,n.lineStart()}function S(R,M){var I=Se([R,M]),v=a(R,M);t(u,d,h,f,p,y,u=v[0],d=v[1],h=R,f=I[0],p=I[1],y=I[2],vs,n),n.point(u,d)}function A(){g.point=m,n.lineEnd()}function _(){x(),g.point=E,g.lineEnd=b}function E(R,M){S(s=R,M),i=u,r=d,o=f,c=p,l=y,g.point=S}function b(){t(u,d,h,f,p,y,i,r,s,o,c,l,vs,n),g.lineEnd=A,A()}return g}}var $o=Sn({point:function(a,e){this.stream.point(a*G,e*G)}});function Yo(a){return Sn({point:function(e,t){var n=a(e,t);return this.stream.point(n[0],n[1])}})}function Qo(a,e,t,n,s){function i(r,o){return r*=n,o*=s,[e+a*r,t-a*o]}return i.invert=function(r,o){return[(r-e)/a*n,(t-o)/a*s]},i}function Ns(a,e,t,n,s,i){if(!i)return Qo(a,e,t,n,s);var r=F(i),o=B(i),c=r*a,l=o*a,h=r/a,u=o/a,d=(o*t-r*e)/a,f=(o*e+r*t)/a;function p(y,g){return y*=n,g*=s,[c*y-l*g+e,t-l*y-c*g]}return p.invert=function(y,g){return[n*(h*y-u*g+d),s*(f-u*y-h*g)]},p}function Zo(a){return ea(function(){return a})()}function ea(a){var e,t=150,n=480,s=250,i=0,r=0,o=0,c=0,l=0,h,u=0,d=1,f=1,p=null,y=_s,g=null,m,x,S,A=Es,_=.5,E,b,R,M,I;function v(T){return R(T[0]*G,T[1]*G)}function U(T){return T=R.invert(T[0],T[1]),T&&[T[0]*X,T[1]*X]}v.stream=function(T){return M&&I===T?M:M=$o(Yo(h)(y(E(A(I=T)))))},v.preclip=function(T){return arguments.length?(y=T,p=void 0,P()):y},v.postclip=function(T){return arguments.length?(A=T,g=m=x=S=null,P()):A},v.clipAngle=function(T){return arguments.length?(y=+T?Bo(p=T*G):(p=null,_s),P()):p*X},v.clipExtent=function(T){return arguments.length?(A=T==null?(g=m=x=S=null,Es):Uo(g=+T[0][0],m=+T[0][1],x=+T[1][0],S=+T[1][1]),P()):g==null?null:[[g,m],[x,S]]},v.scale=function(T){return arguments.length?(t=+T,C()):t},v.translate=function(T){return arguments.length?(n=+T[0],s=+T[1],C()):[n,s]},v.center=function(T){return arguments.length?(i=T[0]%360*G,r=T[1]%360*G,C()):[i*X,r*X]},v.rotate=function(T){return arguments.length?(o=T[0]%360*G,c=T[1]%360*G,l=T.length>2?T[2]%360*G:0,C()):[o*X,c*X,l*X]},v.angle=function(T){return arguments.length?(u=T%360*G,C()):u*X},v.reflectX=function(T){return arguments.length?(d=T?-1:1,C()):d<0},v.reflectY=function(T){return arguments.length?(f=T?-1:1,C()):f<0},v.precision=function(T){return arguments.length?(E=Rs(b,_=T*T),P()):_t(_)},v.fitExtent=function(T,N){return ni(v,T,N)},v.fitSize=function(T,N){return Vo(v,T,N)},v.fitWidth=function(T,N){return qo(v,T,N)},v.fitHeight=function(T,N){return Ko(v,T,N)};function C(){var T=Ns(t,0,0,d,f,u).apply(null,e(i,r)),N=Ns(t,n-T[0],s-T[1],d,f,u);return h=Qs(o,c,l),b=pn(e,N),R=pn(h,b),E=Rs(b,_),P()}function P(){return M=I=null,v}return function(){return e=a.apply(this,arguments),v.invert=e.invert&&U,C()}}function _n(a,e){return[a,bo(Ro((K+e)/2))]}_n.invert=function(a,e){return[a,2*Ys(Eo(e))-K]};function ta(){return na(_n).scale(961/Z)}function na(a){var e=Zo(a),t=e.center,n=e.scale,s=e.translate,i=e.clipExtent,r=null,o,c,l;e.scale=function(u){return arguments.length?(n(u),h()):n()},e.translate=function(u){return arguments.length?(s(u),h()):s()},e.center=function(u){return arguments.length?(t(u),h()):t()},e.clipExtent=function(u){return arguments.length?(u==null?r=o=c=l=null:(r=+u[0][0],o=+u[0][1],c=+u[1][0],l=+u[1][1]),h()):r==null?null:[[r,o],[c,l]]};function h(){var u=L*n(),d=e(Lo(e.rotate()).invert([0,0]));return i(r==null?[[d[0]-u,d[1]-u],[d[0]+u,d[1]+u]]:a===_n?[[Math.max(d[0]-u,r),o],[Math.min(d[0]+u,c),l]]:[[r,Math.max(d[1]-u,o)],[c,Math.min(d[1]+u,l)]])}return h()}class ua extends wt{constructor(t,n={}){super();En(this,"geoProjection",t=>{let{geoProjectionCenter:n,geoProjectionScale:s,geoProjectionTranslate:i}=this.config;return ta().center(n).scale(s).translate(i)(t)});let s={geoProjectionCenter:[0,0],geoProjectionScale:120,geoProjectionTranslate:[0,0],isOrthographic:!1};this.config=Object.assign({},s,n),this.canvas=t,this.scene=new Hi,this.sizes=new Vi(this),this.time=new qi(this),this.camera=new To(this,{isOrthographic:this.config.isOrthographic}),this.renderer=new Pr(this),this.sizes.on("resize",()=>{this.resize()}),this.time.on("tick",i=>{this.update(i)})}setAxesHelper(t=250){if(!t)return!1;let n=new Ji(t);this.scene.add(n)}resize(){this.camera.resize(),this.renderer.resize()}update(t){this.camera.update(t),this.renderer.update(t)}destroy(){this.sizes.destroy(),this.time.destroy(),this.camera.destroy(),this.renderer.destroy(),this.scene.traverse(t=>{if(t instanceof ks){t.geometry.dispose();for(const n in t.material){const s=t.material[n];s&&typeof s.dispose=="function"&&s.dispose()}}}),this.canvas.parentNode.removeChild(this.canvas)}}export{ha as E,Gr as F,ua as M,la as N,oa as R,w as V,Nr as a,Yr as b,aa as c,ta as g,ra as m,ca as p};
