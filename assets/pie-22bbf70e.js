import{G as m,aA as w,C as d,E as b,d as y,b as c,S as u,a8 as C,L as x,a9 as v,l as G,M as A,D as L,a5 as P,R,w as S,aB as E,aC as g,A as M,aD as D,aE as B}from"./OrbitControls-9c9ee6bc.js";import{s as N}from"./stats.module-077ce25d.js";import{G as O}from"./lil-gui.module.min-f00c3c61.js";class H{constructor(t={}){this.options=Object.assign({},{renderId:"",data:[],borderList:[],thickness:2,colors:["#3da6ff","#2ceef5","#f2c62a","#26c7b7","#ff823b"],opacity:1,radius:1,innerRadius:0},t),this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.gui=null,this.borderGroup=new m,this.borderGroup.rotation.x=-Math.PI/2,this.init()}init(){this.scene=new w,this.scene.background=new d("#000000"),this.canvasDom=document.querySelector(this.options.renderId),this.width=this.canvasDom.clientWidth,this.height=this.canvasDom.clientHeight,this.gui=new O,this.borderList=this.options.borderList||[];let t={内圆半径:0,透明度:1,金属度:0,粗超度:.5};this.gui.add(t,"内圆半径",0,1,.1).onChange(i=>{this.options.innerRadius=Number(i),this.scene.remove(this.pieGroup),this.createPieRing()}),this.gui.add(t,"透明度",0,1,.01).onChange(i=>{this.materials.map(e=>{e.opacity=Number(i)}),this.options.opacity=Number(i)}),this.gui.add(t,"金属度",0,1,.01).onChange(i=>{this.materials.map(e=>{e.metalness=Number(i)})}),this.gui.add(t,"粗超度",0,1,.01).onChange(i=>{this.materials.map(e=>{e.roughness=Number(i)})}),this.initCamera(),this.initRenderer(),this.initLight(),this.initControls(),this.createBorderList(),this.createPieRing(),this.loop()}createPieRing(){this.pieGroup=new m,this.pieGroup.name="pieGroup",this.pieGroup.rotation.x=-Math.PI/2,this.scene.add(this.pieGroup);const t=this.options.data.reduce((n,s)=>n+s.value,0);let i=0,e=[];this.options.data.forEach((n,s)=>{let a=n.value/t;const o=a*Math.PI*2,h={steps:10,depth:this.options.thickness*a,bevelEnabled:!1},r=new b(this.addRingShape({startAngle:i,endAngle:i+o}),h);let l=new y({color:new d(n.color),transparent:!0,opacity:this.options.opacity,transparent:!0,metalness:0,roughness:.5});const p=l.clone();p.color=new d(n.color).addScalar(-.2),e.push(l,p),this.materials=e;const f=new c(r,[l,p]);f.name="ring"+s,this.pieGroup.add(f),i+=o})}addRingShape(t={}){let i={percent:.1,...this.options.ringOption},e=Object.assign(i,t),n=new u;n.arc(0,0,e.outerRadius,e.startAngle,e.endAngle);let s=n.getPoints(120),a=new u;a.arc(0,0,this.options.innerRadius,e.endAngle,e.startAngle,!0);let o=a.getPoints(120);return new u(s.concat(o))}createEdge(t){var i=new C(t.geometry,1),e=new x({color:new d(16777215),transparent:!0,opacity:.5}),n=new v(i,e);t.add(n)}createBorderList(){this.borderAnimate=[],this.borderList.forEach(t=>{this.createBorder(t)}),this.scene.add(this.borderGroup)}createBorder(t){let e=Object.assign({url:"texture/ring1.png",width:5.5,z:0,position:[0,0,0],animate:!1,duration:1e3,color:null},t);const n=new G(e.width,e.width),s=new A({map:this.getTexture(e.url),transparent:!0,side:L});e.color&&(s.color=new d(e.color));const a=new c(n,s);a.position.set(...e.position),e.animate&&this.borderAnimate.push(a),this.borderGroup.add(a)}getTexture(t){const i=new P().load(t);return i.wrapS=i.wrapT=R,i}initCamera(){var t=this.width/this.height;this.camera=new S(30,t,.1,100),this.camera.position.set(4.972679988078243,4.643664044427053,5.723022308725478),this.camera.lookAt(0,0,0)}initRenderer(){this.renderer=new E({antialias:!0,preserveDrawingBuffer:!0,logarithmicDepthBuffer:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.canvasDom.appendChild(this.renderer.domElement)}initLight(){[{name:"主灯光",position:[0,2,0],intensity:1.5,color:"#ffffff",type:"main"},{name:"3点钟辅助灯",position:[2,0,0],intensity:.5,color:"#ffffff"},{name:"6点钟辅助灯",position:[0,0,-2],intensity:.5,color:"#ffffff"},{name:"9点钟辅助灯",position:[-2,0,0],intensity:.5,color:"#ffffff"},{name:"12点钟辅助灯",position:[0,0,2],intensity:.5,color:"#ffffff"}].map(e=>{const n="PointLight";let s=new g[n](new d(e.color),e.intensity,100);s.position.set(...e.position);let a=new g[n+"Helper"](s,.1);this.scene.add(s,a);const o=this.gui.addFolder(e.name);let h={灯光强度:e.intensity,灯光辅助:!0,灯光颜色:"#ffffff",位置x:e.position[0],位置y:e.position[1],位置z:e.position[2]};o.add(h,"灯光强度",0,10,.1).onChange(r=>{s.intensity=Number(r)}),o.add(h,"灯光辅助").onChange(r=>{a.visible=r}),e.type&&(o.addColor(h,"灯光颜色").onChange(r=>{s.color=new d(r)}),o.add(h,"位置x",-3,3,.01).onChange(r=>{s.position.x=Number(r)}),o.add(h,"位置y",-3,3,.01).onChange(r=>{s.position.y=Number(r)}),o.add(h,"位置z",-3,3,.01).onChange(r=>{s.position.z=Number(r)})),o.onChange(r=>{a.update()})});let i=new M(16777215,.5);this.scene.add(i)}initAxes(){const t=new D(10);this.scene.add(t),this.stats=new N,document.body.appendChild(this.stats.dom)}initControls(){this.controls=new B(this.camera,this.renderer.domElement),this.controls.maxPolarAngle=Math.PI/2.5,this.controls.autoRotate=!1,this.controls.enableDamping=!0,this.controls.enabled=!0}loop(){this.renderer.setAnimationLoop(()=>{this.stats&&this.stats.update(),this.renderer.render(this.scene,this.camera),this.controls.update(),this.borderAnimate.length&&this.borderAnimate.map(t=>{t.rotation.z+=.01})})}start(){this.loop()}destroy(){this.controls.dispose(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.gui&&this.gui.destroy(),this.scene.traverse(t=>{if(t instanceof c){t.geometry.dispose();for(const i in t.material){const e=t.material[i];e&&typeof e.dispose=="function"&&e.dispose()}}}),this.canvasDom.removeChild(this.renderer.domElement)}}export{H as T};
